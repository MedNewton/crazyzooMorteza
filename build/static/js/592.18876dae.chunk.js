"use strict";(self.webpackChunkaxies_reactjs=self.webpackChunkaxies_reactjs||[]).push([[592],{33526:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.HEARTBEAT_EVENTS=t.HEARTBEAT_INTERVAL=void 0;var n=r(63182);t.HEARTBEAT_INTERVAL=n.FIVE_SECONDS,t.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"}},32940:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r(3431).__exportStar(r(33526),t)},36509:function(e,t,r){var n=r(17061).default,i=r(56690).default,s=r(89728).default,a=r(61655).default,o=r(26389).default;Object.defineProperty(t,"__esModule",{value:!0}),t.HeartBeat=void 0;var c=r(3431),u=r(47465),p=r(63182),l=r(23716),f=r(32940),h=function(e){a(r,e);var t=o(r);function r(e){var n;return i(this,r),(n=t.call(this,e)).events=new u.EventEmitter,n.interval=f.HEARTBEAT_INTERVAL,n.interval=(null===e||void 0===e?void 0:e.interval)||f.HEARTBEAT_INTERVAL,n}return s(r,[{key:"init",value:function(){return c.__awaiter(this,void 0,void 0,n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initialize();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"stop",value:function(){clearInterval(this.intervalRef)}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}},{key:"off",value:function(e,t){this.events.off(e,t)}},{key:"removeListener",value:function(e,t){this.events.removeListener(e,t)}},{key:"initialize",value:function(){return c.__awaiter(this,void 0,void 0,n().mark((function e(){var t=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.intervalRef=setInterval((function(){return t.pulse()}),p.toMiliseconds(this.interval));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"pulse",value:function(){this.events.emit(f.HEARTBEAT_EVENTS.pulse)}}],[{key:"init",value:function(e){return c.__awaiter(this,void 0,void 0,n().mark((function t(){var i;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=new r(e),t.next=3,i.init();case 3:return t.abrupt("return",i);case 4:case"end":return t.stop()}}),t)})))}}]),r}(l.IHeartBeat);t.HeartBeat=h},25952:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(3431);n.__exportStar(r(36509),t),n.__exportStar(r(23716),t),n.__exportStar(r(32940),t)},22340:function(e,t,r){var n=r(89728).default,i=r(56690).default,s=r(61655).default,a=r(26389).default;Object.defineProperty(t,"__esModule",{value:!0}),t.IHeartBeat=void 0;var o=function(e){s(r,e);var t=a(r);function r(e){return i(this,r),t.call(this)}return n(r)}(r(98196).IEvents);t.IHeartBeat=o},23716:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r(3431).__exportStar(r(22340),t)},77592:function(e,t,r){r.r(t),r.d(t,{UniversalProvider:function(){return xs},default:function(){return ms}});var n=r(29439),i=r(37762),s=r(74165),a=r(15861),o=r(15671),c=r(43144),u=r(32656),p=r.n(u),l=r(97326),f=r(93433),h=r(60136),d=r(29388),v=r(4942),g=r(1413),y=r(47465),m=r.n(y),x=r(53719),b=r(25952),w=r(21581),Z=r(90948),k=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this)).opts=e,n.protocol="wc",n.version=2,n}return(0,c.Z)(r)}(Z.q),E=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,o.Z)(this,r),(i=t.call(this)).core=e,i.logger=n,i.records=new Map,i}return(0,c.Z)(r)}(Z.q),I=(0,c.Z)((function e(t,r){(0,o.Z)(this,e),this.logger=t,this.core=r})),_=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,o.Z)(this,r),(i=t.call(this)).relayer=e,i.logger=n,i}return(0,c.Z)(r)}(Z.q),S=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){return(0,o.Z)(this,r),t.call(this)}return(0,c.Z)(r)}(Z.q),P=(0,c.Z)((function e(t,r,n,i){(0,o.Z)(this,e),this.core=t,this.logger=r,this.name=n})),R=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,o.Z)(this,r),(i=t.call(this)).relayer=e,i.logger=n,i}return(0,c.Z)(r)}(Z.q),N=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,o.Z)(this,r),(i=t.call(this)).core=e,i.logger=n,i}return(0,c.Z)(r)}(Z.q),O=(m(),(0,c.Z)((function e(t){(0,o.Z)(this,e),this.opts=t,this.protocol="wc",this.version=2}))),T=(y.EventEmitter,(0,c.Z)((function e(t){(0,o.Z)(this,e),this.client=t}))),A=r(75457),C=r(58781),D=r(53642),q=r(52497),U=r(56271),z=r(24888),M=r(52029);function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}function V(e,t){t||(t=e.reduce((function(e,t){return e+t.length}),0));var r,n=L(t),s=0,a=(0,i.Z)(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;n.set(o,s),s+=o.length}}catch(c){a.e(c)}finally{a.f()}return n}var j=r(86864);function K(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var H=K("utf8","u",(function(e){return"u"+new TextDecoder("utf8").decode(e)}),(function(e){return(new TextEncoder).encode(e.substring(1))})),G=K("ascii","a",(function(e){for(var t="a",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(function(e){for(var t=L((e=e.substring(1)).length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),J=(0,g.Z)({utf8:H,"utf-8":H,hex:j.gh.base16,latin1:G,ascii:G,binary:G},j.gh);function B(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=J[t];if(!r)throw new Error('Unsupported encoding "'.concat(t,'"'));return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode("".concat(r.prefix).concat(e)):globalThis.Buffer.from(e,"utf8")}function Y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=J[t];if(!r)throw new Error('Unsupported encoding "'.concat(t,'"'));return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}var F=r(59761),W=r(63182),X=r(29808),Q=r(37296),$=r(89847),ee=r(44859);var te="base10",re="base16",ne="base64pad",ie="utf8",se=0,ae=1,oe=0,ce=1,ue=12,pe=32;function le(){return Y((0,U.randomBytes)(pe),re)}function fe(e){return Y((0,z.vp)(B(e,re)),re)}function he(e){return Y((0,z.vp)(B(e,ie)),re)}function de(e){return Number(Y(e,te))}function ve(e){var t=function(e){return B("".concat(e),te)}(typeof e.type<"u"?e.type:se);if(de(t)===ae&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");var r=typeof e.senderPublicKey<"u"?B(e.senderPublicKey,re):void 0,n=typeof e.iv<"u"?B(e.iv,re):(0,U.randomBytes)(ue);return function(e){if(de(e.type)===ae){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Y(V([e.type,e.senderPublicKey,e.iv,e.sealed]),ne)}return Y(V([e.type,e.iv,e.sealed]),ne)}({type:t,sealed:new D.OK(B(e.symKey,re)).seal(n,B(e.message,ie)),iv:n,senderPublicKey:r})}function ge(e){var t=new D.OK(B(e.symKey,re)),r=ye(e.encoded),n=r.sealed,i=r.iv,s=t.open(i,n);if(null===s)throw new Error("Failed to decrypt");return Y(s,ie)}function ye(e){var t=B(e,ne),r=t.slice(oe,ce),n=ce;if(de(r)===ae){var i=n+pe,s=i+ue,a=t.slice(n,i),o=t.slice(i,s);return{type:r,sealed:t.slice(s),iv:o,senderPublicKey:a}}var c=n+ue,u=t.slice(n,c);return{type:r,sealed:t.slice(c),iv:u}}function me(e,t){var r=ye(e);return xe({type:de(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Y(r.senderPublicKey,re):void 0,receiverPublicKey:null===t||void 0===t?void 0:t.receiverPublicKey})}function xe(e){var t=(null===e||void 0===e?void 0:e.type)||se;if(t===ae){if(typeof(null===e||void 0===e?void 0:e.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(null===e||void 0===e?void 0:e.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:null===e||void 0===e?void 0:e.senderPublicKey,receiverPublicKey:null===e||void 0===e?void 0:e.receiverPublicKey}}function be(e){return e.type===ae&&"string"==typeof e.senderPublicKey&&"string"==typeof e.receiverPublicKey}var we=Object.defineProperty,Ze=Object.getOwnPropertySymbols,ke=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable,Ie=function(e,t,r){return t in e?we(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},_e=function(e,t){for(var r in t||(t={}))ke.call(t,r)&&Ie(e,r,t[r]);if(Ze){var n,s=(0,i.Z)(Ze(t));try{for(s.s();!(n=s.n()).done;){r=n.value;Ee.call(t,r)&&Ie(e,r,t[r])}}catch(a){s.e(a)}finally{s.f()}}return e},Se="ReactNative",Pe={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Re="js";function Ne(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Oe(){return!(0,X.getDocument)()&&(0,X.getNavigator)()&&navigator.product===Se?Pe.reactNative:Ne()?Pe.node:!Ne()&&(0,X.getNavigator)()?Pe.browser:Pe.unknown}function Te(e,t,r){var n=function(){var e=(0,F.qY)();if(null===e)return"unknown";var t=e.os?e.os.replace(" ","").toLowerCase():"unknown";return"browser"===e.type?[t,e.name,e.version].join("-"):[t,e.version].join("-")}(),i=function(){var e,t=Oe();return t===Pe.browser?[t,(null==(e=(0,X.getLocation)())?void 0:e.host)||"unknown"].join(":"):t}();return[[e,t].join("-"),[Re,r].join("-"),n,i].join("/")}function Ae(e){var t=e.protocol,r=e.version,n=e.relayUrl,i=e.sdkVersion,s=e.auth,a=e.projectId,o=n.split("?"),c={auth:s,ua:Te(t,r,i),projectId:a},u=function(e,t){var r=$.parse(e);return r=_e(_e({},r),t),$.stringify(r)}(o[1]||"",c);return o[0]+"?"+u}function Ce(e,t){return e.filter((function(e){return t.includes(e)})).length===e.length}function De(e){return Object.fromEntries(e.entries())}function qe(e){return new Map(Object.entries(e))}function Ue(e,t){return(0,W.fromMiliseconds)((t||Date.now())+(0,W.toMiliseconds)(e))}function ze(e){return(0,W.fromMiliseconds)(Date.now())>=(0,W.toMiliseconds)(e)}function Me(e){var t,r,n,i=(0,W.toMiliseconds)(e||W.FIVE_MINUTES);return{resolve:function(e){n&&t&&(clearTimeout(n),t(e))},reject:function(e){n&&r&&(clearTimeout(n),r(e))},done:function(){return new Promise((function(e,s){n=setTimeout(s,i),t=e,r=s}))}}}function Le(e,t){return new Promise(function(){var r=(0,a.Z)((0,s.Z)().mark((function r(n,i){var a,o;return(0,s.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=setTimeout((function(){return i()}),t),r.next=3,e;case 3:o=r.sent,clearTimeout(a),n(o);case 5:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}function Ve(e,t){if("string"==typeof t&&t.startsWith("".concat(e,":")))return t;if("topic"===e.toLowerCase()){if("string"!=typeof t)throw new Error('Value must be "string" for expirer target type: topic');return"topic:".concat(t)}if("id"===e.toLowerCase()){if("number"!=typeof t)throw new Error('Value must be "number" for expirer target type: id');return"id:".concat(t)}throw new Error("Unknown expirer target type: ".concat(e))}function je(e){var t=e.split(":"),r=(0,n.Z)(t,2),i=r[0],s=r[1],a={id:void 0,topic:void 0};if("topic"===i&&"string"==typeof s)a.topic=s;else{if("id"!==i||!Number.isInteger(Number(s)))throw new Error("Invalid target, expected id:number or topic:string, got ".concat(i,":").concat(s));a.id=Number(s)}return a}function Ke(e,t){return"".concat(e).concat(t?":".concat(t):"")}function He(e){return(null===e||void 0===e?void 0:e.relay)||{protocol:"irn"}}function Ge(e){var t=ee.RELAY_JSONRPC[e];if(typeof t>"u")throw new Error("Relay Protocol not supported: ".concat(e));return t}var Je=Object.defineProperty,Be=Object.getOwnPropertySymbols,Ye=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable,We=function(e,t,r){return t in e?Je(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r};function Xe(e){var t={},r="relay"+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-");return Object.keys(e).forEach((function(n){if(n.startsWith(r)){var i=n.replace(r,""),s=e[n];t[i]=s}})),t}function Qe(e){var t=e.indexOf(":"),r=-1!==e.indexOf("?")?e.indexOf("?"):void 0,n=e.substring(0,t),i=e.substring(t+1,r).split("@"),s=typeof r<"u"?e.substring(r):"",a=$.parse(s);return{protocol:n,topic:i[0],version:parseInt(i[1],10),symKey:a.symKey,relay:Xe(a)}}function $e(e){return"".concat(e.protocol,":").concat(e.topic,"@").concat(e.version,"?")+$.stringify(function(e,t){for(var r in t||(t={}))Ye.call(t,r)&&We(e,r,t[r]);if(Be){var n,s=(0,i.Z)(Be(t));try{for(s.s();!(n=s.n()).done;)r=n.value,Fe.call(t,r)&&We(e,r,t[r])}catch(a){s.e(a)}finally{s.f()}}return e}({symKey:e.symKey},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",r={};return Object.keys(e).forEach((function(n){var i="relay"+t+n;e[n]&&(r[i]=e[n])})),r}(e.relay)))}function et(e){var t=[];return e.forEach((function(e){var r=e.split(":"),i=(0,n.Z)(r,2),s=i[0],a=i[1];t.push("".concat(s,":").concat(a))})),t}function tt(e,t){var r=xt(e,t);if(r)throw new Error(r.message);for(var i={},s=0,a=Object.entries(e);s<a.length;s++){var o=(0,n.Z)(a[s],2),c=o[0],u=o[1];i[c]={methods:u.methods,events:u.events,chains:u.accounts.map((function(e){return"".concat(e.split(":")[0],":").concat(e.split(":")[1])}))}}return i}var rt={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},nt={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function it(e,t){var r=nt[e],n=r.message,i=r.code;return{message:t?"".concat(n," ").concat(t):n,code:i}}function st(e,t){var r=rt[e],n=r.message,i=r.code;return{message:t?"".concat(n," ").concat(t):n,code:i}}function at(e,t){return!!Array.isArray(e)&&(!(typeof t<"u"&&e.length)||e.every(t))}function ot(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function ct(e){return typeof e>"u"}function ut(e,t){return!(!t||!ct(e))||"string"==typeof e&&Boolean(e.trim().length)}function pt(e,t){return!(!t||!ct(e))||"number"==typeof e&&!isNaN(e)}function lt(e){return!(!ut(e,!1)||!e.includes(":"))&&2===e.split(":").length}function ft(e){var t;return null==(t=null===e||void 0===e?void 0:e.proposer)?void 0:t.publicKey}function ht(e){return null===e||void 0===e?void 0:e.topic}function dt(e){var t=!0;return at(e)?e.length&&(t=e.every((function(e){return ut(e,!1)}))):t=!1,t}function vt(e,t){var r=null;return Object.entries(e).forEach((function(e){var i=(0,n.Z)(e,2),s=i[0],a=i[1];if(!r){var o=function(e,t,r){var n=null;return at(t)?t.forEach((function(t){n||(!lt(t)||!t.includes(e))&&(n=st("UNSUPPORTED_CHAINS","".concat(r,", chain ").concat(t,' should be a string and conform to "namespace:chainId" format')))})):n=st("UNSUPPORTED_CHAINS","".concat(r,", chains ").concat(t,' should be an array of strings conforming to "namespace:chainId" format')),n}(s,null===a||void 0===a?void 0:a.chains,"".concat(t," requiredNamespace"));o&&(r=o)}})),r}function gt(e,t){var r=null;return at(e)?e.forEach((function(e){r||function(e){if(ut(e,!1)&&e.includes(":")){var t=e.split(":");if(3===t.length){var r=t[0]+":"+t[1];return!!t[2]&&lt(r)}}return!1}(e)||(r=st("UNSUPPORTED_ACCOUNTS","".concat(t,", account ").concat(e,' should be a string and conform to "namespace:chainId:address" format')))})):r=st("UNSUPPORTED_ACCOUNTS","".concat(t,', accounts should be an array of strings conforming to "namespace:chainId:address" format')),r}function yt(e,t){var r=null;return Object.values(e).forEach((function(e){if(!r){var n=function(e,t){var r=null;return dt(null===e||void 0===e?void 0:e.methods)?dt(null===e||void 0===e?void 0:e.events)||(r=st("UNSUPPORTED_EVENTS","".concat(t,", events should be an array of strings or empty array for no events"))):r=st("UNSUPPORTED_METHODS","".concat(t,", methods should be an array of strings or empty array for no methods")),r}(e,"".concat(t,", namespace"));n&&(r=n)}})),r}function mt(e,t){var r=null;if(e&&ot(e)){var n=yt(e,t);n&&(r=n);var i=vt(e,t);i&&(r=i)}else r=it("MISSING_OR_INVALID","".concat(t,", requiredNamespaces should be an object with data"));return r}function xt(e,t){var r=null;if(e&&ot(e)){var n=yt(e,t);n&&(r=n);var i=function(e,t){var r=null;return Object.values(e).forEach((function(e){if(!r){var n=gt(null===e||void 0===e?void 0:e.accounts,"".concat(t," namespace"));n&&(r=n)}})),r}(e,t);i&&(r=i)}else r=it("MISSING_OR_INVALID","".concat(t,", namespaces should be an object with data"));return r}function bt(e){return ut(e.protocol,!0)}function wt(e,t){var r=!1;return t&&!e?r=!0:e&&at(e)&&e.length&&e.forEach((function(e){r=bt(e)})),r}function Zt(e){return"number"==typeof e}function kt(e){return typeof e<"u"&&null!==typeof e}function Et(e){return!(!e||"object"!=typeof e||!e.code||!pt(e.code,!1)||!e.message||!ut(e.message,!1))}function It(e){return!(ct(e)||!ut(e.method,!1))}function _t(e){return!(ct(e)||ct(e.result)&&ct(e.error)||!pt(e.id,!1)||!ut(e.jsonrpc,!1))}function St(e){return!(ct(e)||!ut(e.name,!1))}function Pt(e,t){return!(!lt(t)||!function(e){var t=[];return Object.values(e).forEach((function(e){t.push.apply(t,(0,f.Z)(et(e.accounts)))})),t}(e).includes(t))}function Rt(e,t,r){return!!ut(r,!1)&&function(e,t){var r=[];return Object.values(e).forEach((function(e){et(e.accounts).includes(t)&&r.push.apply(r,(0,f.Z)(e.methods))})),r}(e,t).includes(r)}function Nt(e,t,r){return!!ut(r,!1)&&function(e,t){var r=[];return Object.values(e).forEach((function(e){et(e.accounts).includes(t)&&r.push.apply(r,(0,f.Z)(e.events))})),r}(e,t).includes(r)}function Ot(e,t,r){var n=null,i=Object.keys(e);return Ce(i,Object.keys(t))?i.forEach((function(i){n||(Ce(e[i].chains,et(t[i].accounts))?Ce(e[i].methods,t[i].methods)?Ce(e[i].events,t[i].events)||(n=it("NON_CONFORMING_NAMESPACES","".concat(r," namespaces events don't satisfy requiredNamespaces events for ").concat(i))):n=it("NON_CONFORMING_NAMESPACES","".concat(r," namespaces methods don't satisfy requiredNamespaces methods for ").concat(i)):n=it("NON_CONFORMING_NAMESPACES","".concat(r," namespaces accounts don't satisfy requiredNamespaces chains for ").concat(i)))})):n=it("NON_CONFORMING_NAMESPACES","".concat(r," namespaces keys don't satisfy requiredNamespaces")),n}function Tt(e,t){return pt(e,!1)&&e<=t.max&&e>=t.min}var At=r(42829),Ct=r(28477),Dt=r(86231),qt=r(32467),Ut=r.n(qt);var zt=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),a=s.charCodeAt(0);if(255!==r[a])throw new TypeError(s+" is ambiguous");r[a]=i}var o=e.length,c=e.charAt(0),u=Math.log(o)/Math.log(256),p=Math.log(256)/Math.log(o);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,a=new Uint8Array(s);e[t];){var p=r[e.charCodeAt(t)];if(255===p)return;for(var l=0,f=s-1;(0!==p||l<i)&&-1!==f;f--,l++)p+=o*a[f]>>>0,a[f]=p%256>>>0,p=p/256>>>0;if(0!==p)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var h=s-i;h!==s&&0===a[h];)h++;for(var d=new Uint8Array(n+(s-h)),v=n;h!==s;)d[v++]=a[h++];return d}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var a=(s-i)*p+1>>>0,u=new Uint8Array(a);i!==s;){for(var l=t[i],f=0,h=a-1;(0!==l||f<n)&&-1!==h;h--,f++)l+=256*u[h]>>>0,u[h]=l%o>>>0,l=l/o>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var d=a-n;d!==a&&0===u[d];)d++;for(var v=c.repeat(r);d<a;++d)v+=e.charAt(u[d]);return v},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error("Non-".concat(t," character"))}}},Mt=zt,Lt=function(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},Vt=function(){function e(t,r,n){(0,o.Z)(this,e),this.name=t,this.prefix=r,this.baseEncode=n}return(0,c.Z)(e,[{key:"encode",value:function(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}]),e}(),jt=function(){function e(t,r,n){if((0,o.Z)(this,e),this.name=t,this.prefix=r,void 0===r.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}return(0,c.Z)(e,[{key:"decode",value:function(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}},{key:"or",value:function(e){return Ht(this,e)}}]),e}(),Kt=function(){function e(t){(0,o.Z)(this,e),this.decoders=t}return(0,c.Z)(e,[{key:"or",value:function(e){return Ht(this,e)}},{key:"decode",value:function(e){var t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}]),e}(),Ht=function(e,t){return new Kt((0,g.Z)((0,g.Z)({},e.decoders||(0,v.Z)({},e.prefix,e)),t.decoders||(0,v.Z)({},t.prefix,t)))},Gt=function(){function e(t,r,n,i){(0,o.Z)(this,e),this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new Vt(t,r,n),this.decoder=new jt(t,r,i)}return(0,c.Z)(e,[{key:"encode",value:function(e){return this.encoder.encode(e)}},{key:"decode",value:function(e){return this.decoder.decode(e)}}]),e}(),Jt=function(e){var t=e.name,r=e.prefix,n=e.encode,i=e.decode;return new Gt(t,r,n,i)},Bt=function(e){var t=e.prefix,r=e.name,n=e.alphabet,i=Mt(n,r),s=i.encode,a=i.decode;return Jt({prefix:t,name:r,encode:s,decode:function(e){return Lt(a(e))}})},Yt=function(e){var t=e.name,r=e.prefix,n=e.bitsPerChar,i=e.alphabet;return Jt({prefix:r,name:t,encode:function(e){return function(e,t,r){for(var n="="===t[t.length-1],i=(1<<r)-1,s="",a=0,o=0,c=0;c<e.length;++c)for(o=o<<8|e[c],a+=8;a>r;)s+=t[i&o>>(a-=r)];if(a&&(s+=t[i&o<<r-a]),n)for(;s.length*r&7;)s+="=";return s}(e,i,n)},decode:function(e){return function(e,t,r,n){for(var i={},s=0;s<t.length;++s)i[t[s]]=s;for(var a=e.length;"="===e[a-1];)--a;for(var o=new Uint8Array(a*r/8|0),c=0,u=0,p=0,l=0;l<a;++l){var f=i[e[l]];if(void 0===f)throw new SyntaxError("Non-".concat(n," character"));u=u<<r|f,(c+=r)>=8&&(c-=8,o[p++]=255&u>>c)}if(c>=r||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return o}(e,i,n,t)}})},Ft=Jt({prefix:"\0",name:"identity",encode:function(e){return function(e){return(new TextDecoder).decode(e)}(e)},decode:function(e){return function(e){return(new TextEncoder).encode(e)}(e)}}),Wt=Object.freeze({__proto__:null,identity:Ft}),Xt=Yt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Qt=Object.freeze({__proto__:null,base2:Xt}),$t=Yt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),er=Object.freeze({__proto__:null,base8:$t}),tr=Bt({prefix:"9",name:"base10",alphabet:"0123456789"}),rr=Object.freeze({__proto__:null,base10:tr}),nr=Yt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ir=Yt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),sr=Object.freeze({__proto__:null,base16:nr,base16upper:ir}),ar=Yt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),or=Yt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),cr=Yt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ur=Yt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),pr=Yt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),lr=Yt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),fr=Yt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),hr=Yt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),dr=Yt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),vr=Object.freeze({__proto__:null,base32:ar,base32upper:or,base32pad:cr,base32padupper:ur,base32hex:pr,base32hexupper:lr,base32hexpad:fr,base32hexpadupper:hr,base32z:dr}),gr=Bt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),yr=Bt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),mr=Object.freeze({__proto__:null,base36:gr,base36upper:yr}),xr=Bt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),br=Bt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),wr=Object.freeze({__proto__:null,base58btc:xr,base58flickr:br}),Zr=Yt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),kr=Yt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Er=Yt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ir=Yt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),_r=Object.freeze({__proto__:null,base64:Zr,base64pad:kr,base64url:Er,base64urlpad:Ir}),Sr=Array.from("\ud83d\ude80\ud83e\ude90\u2604\ud83d\udef0\ud83c\udf0c\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf0d\ud83c\udf0f\ud83c\udf0e\ud83d\udc09\u2600\ud83d\udcbb\ud83d\udda5\ud83d\udcbe\ud83d\udcbf\ud83d\ude02\u2764\ud83d\ude0d\ud83e\udd23\ud83d\ude0a\ud83d\ude4f\ud83d\udc95\ud83d\ude2d\ud83d\ude18\ud83d\udc4d\ud83d\ude05\ud83d\udc4f\ud83d\ude01\ud83d\udd25\ud83e\udd70\ud83d\udc94\ud83d\udc96\ud83d\udc99\ud83d\ude22\ud83e\udd14\ud83d\ude06\ud83d\ude44\ud83d\udcaa\ud83d\ude09\u263a\ud83d\udc4c\ud83e\udd17\ud83d\udc9c\ud83d\ude14\ud83d\ude0e\ud83d\ude07\ud83c\udf39\ud83e\udd26\ud83c\udf89\ud83d\udc9e\u270c\u2728\ud83e\udd37\ud83d\ude31\ud83d\ude0c\ud83c\udf38\ud83d\ude4c\ud83d\ude0b\ud83d\udc97\ud83d\udc9a\ud83d\ude0f\ud83d\udc9b\ud83d\ude42\ud83d\udc93\ud83e\udd29\ud83d\ude04\ud83d\ude00\ud83d\udda4\ud83d\ude03\ud83d\udcaf\ud83d\ude48\ud83d\udc47\ud83c\udfb6\ud83d\ude12\ud83e\udd2d\u2763\ud83d\ude1c\ud83d\udc8b\ud83d\udc40\ud83d\ude2a\ud83d\ude11\ud83d\udca5\ud83d\ude4b\ud83d\ude1e\ud83d\ude29\ud83d\ude21\ud83e\udd2a\ud83d\udc4a\ud83e\udd73\ud83d\ude25\ud83e\udd24\ud83d\udc49\ud83d\udc83\ud83d\ude33\u270b\ud83d\ude1a\ud83d\ude1d\ud83d\ude34\ud83c\udf1f\ud83d\ude2c\ud83d\ude43\ud83c\udf40\ud83c\udf37\ud83d\ude3b\ud83d\ude13\u2b50\u2705\ud83e\udd7a\ud83c\udf08\ud83d\ude08\ud83e\udd18\ud83d\udca6\u2714\ud83d\ude23\ud83c\udfc3\ud83d\udc90\u2639\ud83c\udf8a\ud83d\udc98\ud83d\ude20\u261d\ud83d\ude15\ud83c\udf3a\ud83c\udf82\ud83c\udf3b\ud83d\ude10\ud83d\udd95\ud83d\udc9d\ud83d\ude4a\ud83d\ude39\ud83d\udde3\ud83d\udcab\ud83d\udc80\ud83d\udc51\ud83c\udfb5\ud83e\udd1e\ud83d\ude1b\ud83d\udd34\ud83d\ude24\ud83c\udf3c\ud83d\ude2b\u26bd\ud83e\udd19\u2615\ud83c\udfc6\ud83e\udd2b\ud83d\udc48\ud83d\ude2e\ud83d\ude46\ud83c\udf7b\ud83c\udf43\ud83d\udc36\ud83d\udc81\ud83d\ude32\ud83c\udf3f\ud83e\udde1\ud83c\udf81\u26a1\ud83c\udf1e\ud83c\udf88\u274c\u270a\ud83d\udc4b\ud83d\ude30\ud83e\udd28\ud83d\ude36\ud83e\udd1d\ud83d\udeb6\ud83d\udcb0\ud83c\udf53\ud83d\udca2\ud83e\udd1f\ud83d\ude41\ud83d\udea8\ud83d\udca8\ud83e\udd2c\u2708\ud83c\udf80\ud83c\udf7a\ud83e\udd13\ud83d\ude19\ud83d\udc9f\ud83c\udf31\ud83d\ude16\ud83d\udc76\ud83e\udd74\u25b6\u27a1\u2753\ud83d\udc8e\ud83d\udcb8\u2b07\ud83d\ude28\ud83c\udf1a\ud83e\udd8b\ud83d\ude37\ud83d\udd7a\u26a0\ud83d\ude45\ud83d\ude1f\ud83d\ude35\ud83d\udc4e\ud83e\udd32\ud83e\udd20\ud83e\udd27\ud83d\udccc\ud83d\udd35\ud83d\udc85\ud83e\uddd0\ud83d\udc3e\ud83c\udf52\ud83d\ude17\ud83e\udd11\ud83c\udf0a\ud83e\udd2f\ud83d\udc37\u260e\ud83d\udca7\ud83d\ude2f\ud83d\udc86\ud83d\udc46\ud83c\udfa4\ud83d\ude47\ud83c\udf51\u2744\ud83c\udf34\ud83d\udca3\ud83d\udc38\ud83d\udc8c\ud83d\udccd\ud83e\udd40\ud83e\udd22\ud83d\udc45\ud83d\udca1\ud83d\udca9\ud83d\udc50\ud83d\udcf8\ud83d\udc7b\ud83e\udd10\ud83e\udd2e\ud83c\udfbc\ud83e\udd75\ud83d\udea9\ud83c\udf4e\ud83c\udf4a\ud83d\udc7c\ud83d\udc8d\ud83d\udce3\ud83e\udd42"),Pr=Sr.reduce((function(e,t,r){return e[r]=t,e}),[]),Rr=Sr.reduce((function(e,t,r){return e[t.codePointAt(0)]=r,e}),[]);var Nr=Jt({prefix:"\ud83d\ude80",name:"base256emoji",encode:function(e){return e.reduce((function(e,t){return e+=Pr[t]}),"")},decode:function(e){var t,r=[],n=(0,i.Z)(e);try{for(n.s();!(t=n.n()).done;){var s=t.value,a=Rr[s.codePointAt(0)];if(void 0===a)throw new Error("Non-base256emoji character: ".concat(s));r.push(a)}}catch(o){n.e(o)}finally{n.f()}return new Uint8Array(r)}}),Or=Object.freeze({__proto__:null,base256emoji:Nr}),Tr=function e(t,r,n){r=r||[];for(var i=n=n||0;t>=Dr;)r[n++]=255&t|Ar,t/=128;for(;t&Cr;)r[n++]=255&t|Ar,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Ar=128,Cr=-128,Dr=Math.pow(2,31);var qr=function e(t,r){var n,i=0,s=0,a=r=r||0,o=t.length;do{if(a>=o)throw e.bytes=0,new RangeError("Could not decode varint");n=t[a++],i+=s<28?(n&zr)<<s:(n&zr)*Math.pow(2,s),s+=7}while(n>=Ur);return e.bytes=a-r,i},Ur=128,zr=127;var Mr=Math.pow(2,7),Lr=Math.pow(2,14),Vr=Math.pow(2,21),jr=Math.pow(2,28),Kr=Math.pow(2,35),Hr=Math.pow(2,42),Gr=Math.pow(2,49),Jr=Math.pow(2,56),Br=Math.pow(2,63),Yr={encode:Tr,decode:qr,encodingLength:function(e){return e<Mr?1:e<Lr?2:e<Vr?3:e<jr?4:e<Kr?5:e<Hr?6:e<Gr?7:e<Jr?8:e<Br?9:10}},Fr=Yr,Wr=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Fr.encode(e,t,r),t},Xr=function(e){return Fr.encodingLength(e)},Qr=function(e,t){var r=t.byteLength,n=Xr(e),i=n+Xr(r),s=new Uint8Array(i+r);return Wr(e,s,0),Wr(r,s,n),s.set(t,i),new $r(e,r,t,s)},$r=(0,c.Z)((function e(t,r,n,i){(0,o.Z)(this,e),this.code=t,this.size=r,this.digest=n,this.bytes=i})),en=function(e){var t=e.name,r=e.code,n=e.encode;return new tn(t,r,n)},tn=function(){function e(t,r,n){(0,o.Z)(this,e),this.name=t,this.code=r,this.encode=n}return(0,c.Z)(e,[{key:"digest",value:function(e){var t=this;if(e instanceof Uint8Array){var r=this.encode(e);return r instanceof Uint8Array?Qr(this.code,r):r.then((function(e){return Qr(t.code,e)}))}throw Error("Unknown type, must be binary type")}}]),e}(),rn=function(e){return function(){var t=(0,a.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Uint8Array,t.next=3,crypto.subtle.digest(e,r);case 3:return t.t1=t.sent,t.abrupt("return",new t.t0(t.t1));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},nn=en({name:"sha2-256",code:18,encode:rn("SHA-256")}),sn=en({name:"sha2-512",code:19,encode:rn("SHA-512")}),an=Object.freeze({__proto__:null,sha256:nn,sha512:sn}),on=Lt,cn={code:0,name:"identity",encode:on,digest:function(e){return Qr(0,on(e))}},un=Object.freeze({__proto__:null,identity:cn});new TextEncoder,new TextDecoder;var pn=(0,g.Z)((0,g.Z)((0,g.Z)((0,g.Z)((0,g.Z)((0,g.Z)((0,g.Z)((0,g.Z)((0,g.Z)((0,g.Z)({},Wt),Qt),er),rr),sr),vr),mr),wr),_r),Or);function ln(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}(0,g.Z)((0,g.Z)({},an),un);var fn=ln("utf8","u",(function(e){return"u"+new TextDecoder("utf8").decode(e)}),(function(e){return(new TextEncoder).encode(e.substring(1))})),hn=ln("ascii","a",(function(e){for(var t="a",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(function(e){for(var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}((e=e.substring(1)).length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),dn=(0,g.Z)({utf8:fn,"utf-8":fn,hex:pn.base16,latin1:hn,ascii:hn,binary:hn},pn);function vn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=dn[t];if(!r)throw new Error('Unsupported encoding "'.concat(t,'"'));return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode("".concat(r.prefix).concat(e)):globalThis.Buffer.from(e,"utf8")}var gn="core",yn="".concat("wc","@",2,":").concat(gn,":"),mn="error",xn={database:":memory:"},bn="client_ed25519_seed",wn=W.ONE_DAY,Zn=W.SIX_HOURS,kn="relayer_message",En="relayer_connect",In="relayer_disconnect",_n="relayer_error",Sn="relayer_connection_stalled",Pn="relayer_transport_closed",Rn="relayer_publish",Nn="payload",On="connect",Tn="disconnect",An="error",Cn=W.ONE_SECOND,Dn="subscription_created",qn="subscription_deleted",Un="subscription_sync",zn="subscription_resubscribed",Mn=(W.THIRTY_DAYS,1e3*W.FIVE_SECONDS),Ln=(W.THIRTY_DAYS,{wc_pairingDelete:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:W.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:W.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:W.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:W.ONE_DAY,prompt:!1,tag:0},res:{ttl:W.ONE_DAY,prompt:!1,tag:0}}}),Vn="history_created",jn="history_updated",Kn="history_deleted",Hn="history_sync",Gn="expirer_created",Jn="expirer_deleted",Bn="expirer_expired",Yn="expirer_sync",Fn=(W.ONE_DAY,function(){function e(t,r){var n=this;(0,o.Z)(this,e),this.core=t,this.logger=r,this.keychain=new Map,this.name="keychain",this.version="0.3",this.initialized=!1,this.storagePrefix=yn,this.init=(0,a.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.initialized){e.next=5;break}return e.next=3,n.getKeyChain();case 3:typeof(t=e.sent)<"u"&&(n.keychain=t),n.initialized=!0;case 5:case"end":return e.stop()}}),e)}))),this.has=function(e){return n.isInitialized(),n.keychain.has(e)},this.set=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),n.keychain.set(t,r),e.next=4,n.persist();case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.get=function(e){n.isInitialized();var t=n.keychain.get(e);if(typeof t>"u"){var r=it("NO_MATCHING_KEY","".concat(n.name,": ").concat(e)).message;throw new Error(r)}return t},this.del=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),n.keychain.delete(t),e.next=4,n.persist();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.core=t,this.logger=(0,w.generateChildLogger)(r,this.name)}return(0,c.Z)(e,[{key:"context",get:function(){return(0,w.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"setKeyChain",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,De(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getKeyChain",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return t=e.sent,e.abrupt("return",typeof t<"u"?qe(t):void 0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"persist",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setKeyChain(this.keychain);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isInitialized",value:function(){if(!this.initialized){var e=it("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),e}()),Wn=function(){function e(t,r,n){var i=this;(0,o.Z)(this,e),this.core=t,this.logger=r,this.name="crypto",this.initialized=!1,this.init=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.initialized,e.t0){e.next=5;break}return e.next=4,i.keychain.init();case 4:i.initialized=!0;case 5:case"end":return e.stop()}}),e)}))),this.hasKeys=function(e){return i.isInitialized(),i.keychain.has(e)},this.getClientId=(0,a.Z)((0,s.Z)().mark((function e(){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.isInitialized(),e.next=3,i.getClientSeed();case 3:return t=e.sent,r=C.generateKeyPair(t),e.abrupt("return",C.encodeIss(r.publicKey));case 6:case"end":return e.stop()}}),e)}))),this.generateKeyPair=function(){i.isInitialized();var e=function(){var e=M.Au();return{privateKey:Y(e.secretKey,re),publicKey:Y(e.publicKey,re)}}();return i.setPrivateKey(e.publicKey,e.privateKey)},this.signJWT=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,n,a,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.isInitialized(),e.next=3,i.getClientSeed();case 3:return r=e.sent,n=C.generateKeyPair(r),a=le(),o=wn,e.next=9,C.signJWT(a,t,o,n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.generateSharedKey=function(e,t,r){i.isInitialized();var n=function(e,t){var r=M.gi(B(e,re),B(t,re));return Y(new q.t(z.mE,r).expand(pe),re)}(i.getPrivateKey(e),t);return i.setSymKey(n,r)},this.setSymKey=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.isInitialized(),n=r||fe(t),e.next=4,i.keychain.set(n,t);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.deleteKeyPair=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.isInitialized(),e.next=3,i.keychain.del(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteSymKey=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.isInitialized(),e.next=3,i.keychain.del(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.encode=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r,n){var a,o,c,u,p,l,f;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isInitialized(),a=xe(n),o=(0,A.u)(r),!be(a)){e.next=7;break}return c=a.senderPublicKey,u=a.receiverPublicKey,e.next=6,i.generateSharedKey(c,u);case 6:t=e.sent;case 7:return p=i.getSymKey(t),l=a.type,f=a.senderPublicKey,e.abrupt("return",ve({type:l,symKey:p,message:o,senderPublicKey:f}));case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.decode=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r,n){var a,o,c,u,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isInitialized(),!be(a=me(r,n))){e.next=7;break}return o=a.receiverPublicKey,c=a.senderPublicKey,e.next=6,i.generateSharedKey(o,c);case 6:t=e.sent;case 7:return u=i.getSymKey(t),p=ge({symKey:u,encoded:r}),e.abrupt("return",(0,A.D)(p));case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.core=t,this.logger=(0,w.generateChildLogger)(r,this.name),this.keychain=n||new Fn(this.core,this.logger)}return(0,c.Z)(e,[{key:"context",get:function(){return(0,w.getLoggerContext)(this.logger)}},{key:"getPayloadType",value:function(e){return de(ye(e).type)}},{key:"setPrivateKey",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keychain.set(t,r);case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getPrivateKey",value:function(e){return this.keychain.get(e)}},{key:"getClientSeed",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t="",e.prev=1,t=this.keychain.get(bn),e.next=10;break;case 5:return e.prev=5,e.t0=e.catch(1),t=le(),e.next=10,this.keychain.set(bn,t);case 10:return e.abrupt("return",vn(t,"base16"));case 11:case"end":return e.stop()}}),e,this,[[1,5]])})));return function(){return e.apply(this,arguments)}}()},{key:"getSymKey",value:function(e){return this.keychain.get(e)}},{key:"isInitialized",value:function(){if(!this.initialized){var e=it("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),e}(),Xn=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,o.Z)(this,r),(i=t.call(this,e,n)).logger=e,i.core=n,i.messages=new Map,i.name="messages",i.version="0.3",i.initialized=!1,i.storagePrefix=yn,i.init=(0,a.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.initialized){e.next=15;break}return i.logger.trace("Initialized"),e.prev=2,e.next=5,i.getRelayerMessages();case 5:typeof(t=e.sent)<"u"&&(i.messages=t),i.logger.debug("Successfully Restored records for ".concat(i.name)),i.logger.trace({type:"method",method:"restore",size:i.messages.size}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),i.logger.debug("Failed to Restore records for ".concat(i.name)),i.logger.error(e.t0);case 12:return e.prev=12,i.initialized=!0,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[2,9,12,15]])}))),i.set=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var n,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isInitialized(),n=he(r),typeof(a=i.messages.get(t))>"u"&&(a={}),e.t0=typeof a[n]<"u",e.t0){e.next=10;break}return a[n]=r,i.messages.set(t,a),e.next=10,i.persist();case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),i.get=function(e){i.isInitialized();var t=i.messages.get(e);return typeof t>"u"&&(t={}),t},i.has=function(e,t){return i.isInitialized(),typeof i.get(e)[he(t)]<"u"},i.del=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.isInitialized(),i.messages.delete(t),e.next=4,i.persist();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.logger=(0,w.generateChildLogger)(e,i.name),i.core=n,i}return(0,c.Z)(r,[{key:"context",get:function(){return(0,w.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"setRelayerMessages",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,De(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRelayerMessages",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return t=e.sent,e.abrupt("return",typeof t<"u"?qe(t):void 0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"persist",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setRelayerMessages(this.messages);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isInitialized",value:function(){if(!this.initialized){var e=it("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),r}(I),Qn=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,o.Z)(this,r),(i=t.call(this,e,n)).relayer=e,i.logger=n,i.events=new y.EventEmitter,i.name="publisher",i.queue=new Map,i.publishTimeout=1e4,i.publish=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r,n){var a,o,c,u,p,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.logger.debug("Publishing Payload"),i.logger.trace({type:"method",method:"publish",params:{topic:t,message:r,opts:n}}),e.prev=1,a=(null===n||void 0===n?void 0:n.ttl)||Zn,o=He(n),c=(null===n||void 0===n?void 0:n.prompt)||!1,u=(null===n||void 0===n?void 0:n.tag)||0,p={topic:t,message:r,opts:{ttl:a,relay:o,prompt:c,tag:u}},l=he(r),i.queue.set(l,p),e.prev=4,e.next=7,Le(i.rpcPublish(t,r,a,o,c,u),i.publishTimeout);case 7:return e.next=9,e.sent;case 9:i.relayer.events.emit(Rn,p),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(4),i.logger.debug("Publishing Payload stalled"),i.relayer.events.emit(Sn),e.abrupt("return");case 16:i.onPublish(l,p),i.logger.debug("Successfully Published Payload"),i.logger.trace({type:"method",method:"publish",params:{topic:t,message:r,opts:n}}),e.next=22;break;case 19:throw e.prev=19,e.t1=e.catch(1),i.logger.debug("Failed to Publish Payload"),i.logger.error(e.t1),e.t1;case 22:case"end":return e.stop()}}),e,null,[[1,19],[4,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),i.on=function(e,t){i.events.on(e,t)},i.once=function(e,t){i.events.once(e,t)},i.off=function(e,t){i.events.off(e,t)},i.removeListener=function(e,t){i.events.removeListener(e,t)},i.relayer=e,i.logger=(0,w.generateChildLogger)(n,i.name),i.registerEventListeners(),i}return(0,c.Z)(r,[{key:"context",get:function(){return(0,w.getLoggerContext)(this.logger)}},{key:"rpcPublish",value:function(e,t,r,n,i,s){var a,o,c,u,p={method:Ge(n.protocol).publish,params:{topic:e,message:t,ttl:r,prompt:i,tag:s}};return ct(null==(a=p.params)?void 0:a.prompt)&&(null==(o=p.params)||delete o.prompt),ct(null==(c=p.params)?void 0:c.tag)&&(null==(u=p.params)||delete u.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:p}),this.relayer.provider.request(p)}},{key:"onPublish",value:function(e,t){this.queue.delete(e)}},{key:"checkQueue",value:function(){var e=this;this.queue.forEach(function(){var t=(0,a.Z)((0,s.Z)().mark((function t(r){var n,i,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.topic,i=r.message,a=r.opts,t.next=3,e.publish(n,i,a);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"registerEventListeners",value:function(){var e=this;this.relayer.core.heartbeat.on(b.HEARTBEAT_EVENTS.pulse,(function(){e.checkQueue()}))}}]),r}(_),$n=function(){function e(){var t=this;(0,o.Z)(this,e),this.map=new Map,this.set=function(e,r){var n=t.get(e);t.exists(e,r)||t.map.set(e,[].concat((0,f.Z)(n),[r]))},this.get=function(e){return t.map.get(e)||[]},this.exists=function(e,r){return t.get(e).includes(r)},this.delete=function(e,r){if(typeof r>"u")t.map.delete(e);else if(t.map.has(e)){var n=t.get(e);if(t.exists(e,r)){var i=n.filter((function(e){return e!==r}));i.length?t.map.set(e,i):t.map.delete(e)}}},this.clear=function(){t.map.clear()}}return(0,c.Z)(e,[{key:"topics",get:function(){return Array.from(this.map.keys())}}]),e}(),ei=Object.defineProperty,ti=Object.defineProperties,ri=Object.getOwnPropertyDescriptors,ni=Object.getOwnPropertySymbols,ii=Object.prototype.hasOwnProperty,si=Object.prototype.propertyIsEnumerable,ai=function(e,t,r){return t in e?ei(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},oi=function(e,t){for(var r in t||(t={}))ii.call(t,r)&&ai(e,r,t[r]);if(ni){var n,s=(0,i.Z)(ni(t));try{for(s.s();!(n=s.n()).done;){r=n.value;si.call(t,r)&&ai(e,r,t[r])}}catch(a){s.e(a)}finally{s.f()}}return e},ci=function(e,t){return ti(e,ri(t))},ui=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,o.Z)(this,r),(i=t.call(this,e,n)).relayer=e,i.logger=n,i.subscriptions=new Map,i.topicMap=new $n,i.events=new y.EventEmitter,i.name="subscription",i.version="0.3",i.pending=new Map,i.cached=[],i.initialized=!1,i.pendingSubscriptionWatchLabel="pending_sub_watch_label",i.pendingSubInterval=20,i.storagePrefix=yn,i.subscribeTimeout=1e4,i.init=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.initialized,e.t0){e.next=7;break}return i.logger.trace("Initialized"),e.next=5,i.restart();case 5:i.registerEventListeners(),i.onEnable();case 7:case"end":return e.stop()}}),e)}))),i.subscribe=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var n,a,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.isInitialized(),i.logger.debug("Subscribing Topic"),i.logger.trace({type:"method",method:"subscribe",params:{topic:t,opts:r}}),e.prev=1,n=He(r),a={topic:t,relay:n},i.pending.set(t,a),e.next=6,i.rpcSubscribe(t,n);case 6:return o=e.sent,e.abrupt("return",(i.onSubscribe(o,a),i.logger.debug("Successfully Subscribed Topic"),i.logger.trace({type:"method",method:"subscribe",params:{topic:t,opts:r}}),o));case 10:throw e.prev=10,e.t0=e.catch(1),i.logger.debug("Failed to Subscribe Topic"),i.logger.error(e.t0),e.t0;case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r){return e.apply(this,arguments)}}(),i.unsubscribe=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isInitialized(),!(typeof(null===r||void 0===r?void 0:r.id)<"u")){e.next=6;break}return e.next=4,i.unsubscribeById(t,r.id,r);case 4:e.next=8;break;case 6:return e.next=8,i.unsubscribeByTopic(t,r);case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),i.isSubscribed=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.topics.includes(t)){e.next=4;break}e.t0=!0,e.next=7;break;case 4:return e.next=6,new Promise((function(e,r){var n=new W.Watch;n.start(i.pendingSubscriptionWatchLabel);var s=setInterval((function(){!i.pending.has(t)&&i.topics.includes(t)&&(clearInterval(s),n.stop(i.pendingSubscriptionWatchLabel),e(!0)),n.elapsed(i.pendingSubscriptionWatchLabel)>=Mn&&(clearInterval(s),n.stop(i.pendingSubscriptionWatchLabel),r(!1))}),i.pendingSubInterval)}));case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.on=function(e,t){i.events.on(e,t)},i.once=function(e,t){i.events.once(e,t)},i.off=function(e,t){i.events.off(e,t)},i.removeListener=function(e,t){i.events.removeListener(e,t)},i.restart=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.restore();case 2:return e.next=4,i.reset();case 4:case"end":return e.stop()}}),e)}))),i.relayer=e,i.logger=(0,w.generateChildLogger)(n,i.name),i}return(0,c.Z)(r,[{key:"context",get:function(){return(0,w.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"length",get:function(){return this.subscriptions.size}},{key:"ids",get:function(){return Array.from(this.subscriptions.keys())}},{key:"values",get:function(){return Array.from(this.subscriptions.values())}},{key:"topics",get:function(){return this.topicMap.topics}},{key:"hasSubscription",value:function(e,t){var r=!1;try{r=this.getSubscription(e).topic===t}catch(n){}return r}},{key:"onEnable",value:function(){this.cached=[],this.initialized=!0}},{key:"onDisable",value:function(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}},{key:"unsubscribeByTopic",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var n,i=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.topicMap.get(t),e.next=3,Promise.all(n.map(function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.unsubscribeById(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"unsubscribeById",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r,n){var i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}}),e.prev=1,i=He(n),e.next=5,this.rpcUnsubscribe(t,r,i);case 5:return a=st("USER_DISCONNECTED","".concat(this.name,", ").concat(t)),e.next=8,this.onUnsubscribe(t,r,a);case 8:this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}}),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(1),this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"rpcSubscribe",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var n,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:Ge(r.protocol).subscribe,params:{topic:t}},this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),e.prev=2,e.next=5,Le(this.relayer.provider.request(n),this.subscribeTimeout);case 5:return e.next=7,e.sent;case 7:i=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Sn);case 13:return e.abrupt("return",i);case 14:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"rpcUnsubscribe",value:function(e,t,r){var n={method:Ge(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.provider.request(n)}},{key:"onSubscribe",value:function(e,t){this.setSubscription(e,ci(oi({},t),{id:e})),this.pending.delete(t.topic)}},{key:"onResubscribe",value:function(e,t){this.addSubscription(e,ci(oi({},t),{id:e})),this.pending.delete(t.topic)}},{key:"onUnsubscribe",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r,n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,n),e.next=4,this.relayer.messages.del(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"setRelayerSubscriptions",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.relayer.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRelayerSubscriptions",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.relayer.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setSubscription",value:function(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}},{key:"addSubscription",value:function(e,t){this.subscriptions.set(e,oi({},t)),this.topicMap.set(t.topic,e),this.events.emit(Dn,t)}},{key:"getSubscription",value:function(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});var t=this.subscriptions.get(e);if(!t){var r=it("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw new Error(r)}return t}},{key:"deleteSubscription",value:function(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});var r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(qn,ci(oi({},r),{reason:t}))}},{key:"persist",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setRelayerSubscriptions(this.values);case 2:this.events.emit(Un);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reset",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.cached.length,!e.t0){e.next=4;break}return e.next=4,Promise.all(this.cached.map(function(){var e=(0,a.Z)((0,s.Z)().mark((function e(r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.resubscribe(r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:this.events.emit(zn);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"restore",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,r,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getRelayerSubscriptions();case 3:if(!(typeof(t=e.sent)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.subscriptions.size){e.next=9;break}throw r=it("RESTORE_WILL_OVERRIDE",this.name),n=r.message,this.logger.error(n),new Error(n);case 9:this.cached=t,this.logger.debug("Successfully Restored subscriptions for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",subscriptions:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore subscriptions for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"resubscribe",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,n,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ids.includes(t.id)){e.next=7;break}return r=t.topic,n=t.relay,i={topic:r,relay:n},this.pending.set(i.topic,i),e.next=5,this.rpcSubscribe(i.topic,i.relay);case 5:a=e.sent,this.onResubscribe(a,i);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onConnect",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.restart();case 2:this.onEnable();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onDisconnect",value:function(){this.onDisable()}},{key:"checkPending",value:function(){var e=this;this.relayer.transportExplicitlyClosed||this.pending.forEach(function(){var t=(0,a.Z)((0,s.Z)().mark((function t(r){var n;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.rpcSubscribe(r.topic,r.relay);case 2:n=t.sent,e.onSubscribe(n,r);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"registerEventListeners",value:function(){var e=this;this.relayer.core.heartbeat.on(b.HEARTBEAT_EVENTS.pulse,(function(){e.checkPending()})),this.relayer.on(En,(0,a.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.onConnect();case 2:case"end":return t.stop()}}),t)})))),this.relayer.on(In,(function(){e.onDisconnect()})),this.events.on(Dn,function(){var t=(0,a.Z)((0,s.Z)().mark((function t(r){var n;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Dn,e.logger.info("Emitting ".concat(n)),e.logger.debug({type:"event",event:n,data:r}),t.next=5,e.persist();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.events.on(qn,function(){var t=(0,a.Z)((0,s.Z)().mark((function t(r){var n;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=qn,e.logger.info("Emitting ".concat(n)),e.logger.debug({type:"event",event:n,data:r}),t.next=5,e.persist();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"isInitialized",value:function(){if(!this.initialized){var e=it("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),r}(R),pi=Object.defineProperty,li=Object.getOwnPropertySymbols,fi=Object.prototype.hasOwnProperty,hi=Object.prototype.propertyIsEnumerable,di=function(e,t,r){return t in e?pi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},vi=function(e,t){for(var r in t||(t={}))fi.call(t,r)&&di(e,r,t[r]);if(li){var n,s=(0,i.Z)(li(t));try{for(s.s();!(n=s.n()).done;){r=n.value;hi.call(t,r)&&di(e,r,t[r])}}catch(a){s.e(a)}finally{s.f()}}return e},gi=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).protocol="wc",n.version=2,n.events=new y.EventEmitter,n.name="relayer",n.transportExplicitlyClosed=!1,n.initialized=!1,n.core=e.core,n.logger=typeof e.logger<"u"&&"string"!=typeof e.logger?(0,w.generateChildLogger)(e.logger,n.name):p()((0,w.getDefaultLoggerOptions)({level:e.logger||"error"})),n.messages=new Xn(n.logger,e.core),n.subscriber=new ui((0,l.Z)(n),n.logger),n.publisher=new Qn((0,l.Z)(n),n.logger),n.relayUrl=(null===e||void 0===e?void 0:e.relayUrl)||"wss://relay.walletconnect.com",n.projectId=e.projectId,n.provider={},n}return(0,c.Z)(r,[{key:"init",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.trace("Initialized"),e.next=3,this.createProvider();case 3:return this.provider=e.sent,e.next=6,Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]);case 6:this.registerEventListeners(),this.initialized=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"context",get:function(){return(0,w.getLoggerContext)(this.logger)}},{key:"connected",get:function(){return this.provider.connection.connected}},{key:"connecting",get:function(){return this.provider.connection.connecting}},{key:"publish",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r,n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isInitialized(),e.next=3,this.publisher.publish(t,r,n);case 3:return e.next=5,this.recordMessageEvent({topic:t,message:r});case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"subscribe",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var n,i=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isInitialized(),n="",e.next=4,Promise.all([new Promise((function(e){i.subscriber.once(Dn,(function(r){r.topic===t&&e()}))})),new Promise(function(){var e=(0,a.Z)((0,s.Z)().mark((function e(a){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.subscriber.subscribe(t,r);case 2:n=e.sent,a();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())]);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"unsubscribe",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isInitialized(),e.next=3,this.subscriber.unsubscribe(t,r);case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}},{key:"off",value:function(e,t){this.events.off(e,t)}},{key:"removeListener",value:function(e,t){this.events.removeListener(e,t)}},{key:"transportClose",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.transportExplicitlyClosed=!0,e.t0=this.connected,!e.t0){e.next=6;break}return e.next=5,this.provider.disconnect();case 5:this.events.emit(Pn);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"transportOpen",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,n=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.relayUrl=t||this.relayUrl,this.transportExplicitlyClosed=!1,e.prev=1,e.t0=Promise,e.t1=new Promise((function(e){n.initialized||e(),n.subscriber.once(zn,(function(){e()}))})),e.next=6,Promise.race([this.provider.connect(),new Promise((function(e,t){return n.once(Pn,(function(){t(new Error("closeTransport called before connection was established"))}))}))]);case 6:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=10,e.t0.all.call(e.t0,e.t3);case 10:e.next=18;break;case 12:if(e.prev=12,e.t4=e.catch(1),r=e.t4,/socket hang up/i.test(r.message)){e.next=17;break}throw new Error(r.message);case 17:this.logger.error(r),this.events.emit(Pn);case 18:case"end":return e.stop()}}),e,this,[[1,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"restartTransport",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.transportClose();case 2:return e.next=4,new Promise((function(e){return setTimeout(e,Cn)}));case 4:return e.next=6,this.transportOpen(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createProvider",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.crypto.signJWT(this.relayUrl);case 2:return t=e.sent,e.abrupt("return",new At.r(new Dt.Z(Ae({sdkVersion:"2.3.3",protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"recordMessageEvent",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.topic,n=t.message,e.next=3,this.messages.set(r,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"shouldIgnoreMessageEvent",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.topic,n=t.message,e.next=3,this.subscriber.isSubscribed(r);case 3:if(!e.sent){e.next=7;break}e.t0=this.messages.has(r,n),e.next=8;break;case 7:e.t0=!0;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onProviderPayload",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),!(0,Ct.isJsonRpcRequest)(t)){e.next=11;break}if(t.method.endsWith("_subscription")){e.next=3;break}return e.abrupt("return");case 3:return r=t.params,n=r.data,i=n.topic,a=n.message,o={topic:i,message:a},this.logger.debug("Emitting Relayer Payload"),this.logger.trace(vi({type:"event",event:r.id},o)),this.events.emit(r.id,o),e.next=9,this.acknowledgePayload(t);case 9:return e.next=11,this.onMessageEvent(o);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onMessageEvent",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.shouldIgnoreMessageEvent(t);case 2:if(e.t0=e.sent,e.t0){e.next=7;break}return this.events.emit(kn,t),e.next=7,this.recordMessageEvent(t);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"acknowledgePayload",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,Ct.formatJsonRpcResult)(t.id,!0),e.next=3,this.provider.connection.send(r);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"registerEventListeners",value:function(){var e=this;this.provider.on(Nn,(function(t){return e.onProviderPayload(t)})),this.provider.on(On,(function(){e.events.emit(En)})),this.provider.on(Tn,(function(){e.events.emit(In),e.attemptToReconnect()})),this.provider.on(An,(function(t){return e.events.emit(_n,t)})),this.events.on(Sn,(0,a.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.restartTransport();case 2:case"end":return t.stop()}}),t)}))))}},{key:"attemptToReconnect",value:function(){var e=this;this.transportExplicitlyClosed||setTimeout((0,a.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.transportOpen();case 2:case"end":return t.stop()}}),t)}))),(0,W.toMiliseconds)(Cn))}},{key:"isInitialized",value:function(){if(!this.initialized){var e=it("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),r}(S),yi=Object.defineProperty,mi=Object.getOwnPropertySymbols,xi=Object.prototype.hasOwnProperty,bi=Object.prototype.propertyIsEnumerable,wi=function(e,t,r){return t in e?yi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},Zi=function(e,t){for(var r in t||(t={}))xi.call(t,r)&&wi(e,r,t[r]);if(mi){var n,s=(0,i.Z)(mi(t));try{for(s.s();!(n=s.n()).done;){r=n.value;bi.call(t,r)&&wi(e,r,t[r])}}catch(a){s.e(a)}finally{s.f()}}return e},ki=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i){var c,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:yn,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return(0,o.Z)(this,r),(c=t.call(this,e,n,i,u)).core=e,c.logger=n,c.name=i,c.map=new Map,c.version="0.3",c.cached=[],c.initialized=!1,c.storagePrefix=yn,c.init=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=c.initialized,e.t0){e.next=8;break}return c.logger.trace("Initialized"),e.next=5,c.restore();case 5:c.cached.forEach((function(e){ft(e)?c.map.set(e.id,e):ht(e)?c.map.set(e.topic,e):c.getKey&&null!==e&&!ct(e)&&c.map.set(c.getKey(e),e)})),c.cached=[],c.initialized=!0;case 8:case"end":return e.stop()}}),e)}))),c.set=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.isInitialized(),!c.map.has(t)){e.next=6;break}return e.next=4,c.update(t,r);case 4:e.next=11;break;case 6:return c.logger.debug("Setting value"),c.logger.trace({type:"method",method:"set",key:t,value:r}),c.map.set(t,r),e.next=11,c.persist();case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),c.get=function(e){return c.isInitialized(),c.logger.debug("Getting value"),c.logger.trace({type:"method",method:"get",key:e}),c.getData(e)},c.getAll=function(e){return c.isInitialized(),e?c.values.filter((function(t){return Object.keys(e).every((function(r){return Ut()(t[r],e[r])}))})):c.values},c.update=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.isInitialized(),c.logger.debug("Updating value"),c.logger.trace({type:"method",method:"update",key:t,update:r}),n=Zi(Zi({},c.getData(t)),r),c.map.set(t,n),e.next=5,c.persist();case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),c.delete=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.isInitialized(),e.t0=c.map.has(t),!e.t0){e.next=8;break}return c.logger.debug("Deleting value"),c.logger.trace({type:"method",method:"delete",key:t,reason:r}),c.map.delete(t),e.next=8,c.persist();case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),c.logger=(0,w.generateChildLogger)(n,c.name),c.storagePrefix=u,c.getKey=p,c}return(0,c.Z)(r,[{key:"context",get:function(){return(0,w.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"length",get:function(){return this.map.size}},{key:"keys",get:function(){return Array.from(this.map.keys())}},{key:"values",get:function(){return Array.from(this.map.values())}},{key:"setDataStore",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDataStore",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getData",value:function(e){var t=this.map.get(e);if(!t){var r=it("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw this.logger.error(r),new Error(r)}return t}},{key:"persist",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setDataStore(this.values);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"restore",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,r,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getDataStore();case 3:if(!(typeof(t=e.sent)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.map.size){e.next=9;break}throw r=it("RESTORE_WILL_OVERRIDE",this.name),n=r.message,this.logger.error(n),new Error(n);case 9:this.cached=t,this.logger.debug("Successfully Restored value for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",value:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore value for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"isInitialized",value:function(){if(!this.initialized){var e=it("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),r}(P),Ei=function(){function e(t,r){var n=this;(0,o.Z)(this,e),this.core=t,this.logger=r,this.name="pairing",this.version="0.3",this.events=new(m()),this.initialized=!1,this.storagePrefix=yn,this.ignoredPayloadTypes=[ae],this.registeredMethods=[],this.init=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n.initialized,e.t0){e.next=10;break}return e.next=4,n.pairings.init();case 4:return e.next=6,n.cleanup();case 6:n.registerRelayerEvents(),n.registerExpirerEvents(),n.initialized=!0,n.logger.trace("Initialized");case 10:case"end":return e.stop()}}),e)}))),this.register=function(e){var t=e.methods;n.isInitialized(),n.registeredMethods=(0,f.Z)(new Set([].concat((0,f.Z)(n.registeredMethods),(0,f.Z)(t))))},this.create=(0,a.Z)((0,s.Z)().mark((function e(){var t,r,i,a,o,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),t=le(),e.next=4,n.core.crypto.setSymKey(t);case 4:return r=e.sent,i=Ue(W.FIVE_MINUTES),o={topic:r,expiry:i,relay:a={protocol:"irn"},active:!1},c=$e({protocol:n.core.protocol,version:n.core.version,topic:r,symKey:t,relay:a}),e.next=11,n.pairings.set(r,o);case 11:return e.next=13,n.core.relayer.subscribe(r);case 13:return n.core.expirer.set(r,i),e.abrupt("return",{topic:r,uri:c});case 15:case"end":return e.stop()}}),e)}))),this.pair=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),n.isValidPair(t),r=Qe(t.uri),i=r.topic,a=r.symKey,o=r.relay,c=Ue(W.FIVE_MINUTES),u={topic:i,relay:o,expiry:c,active:!1},e.next=4,n.pairings.set(i,u);case 4:return e.next=6,n.core.crypto.setSymKey(a,i);case 6:return e.next=8,n.core.relayer.subscribe(i,{relay:o});case 8:if(n.core.expirer.set(i,c),e.t0=t.activatePairing,!e.t0){e.next=13;break}return e.next=13,n.activate({topic:i});case 13:return e.abrupt("return",u);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.activate=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.topic,n.isInitialized(),i=Ue(W.THIRTY_DAYS),e.next=5,n.pairings.update(r,{active:!0,expiry:i});case 5:n.core.expirer.set(r,i);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.ping=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidPing(t);case 3:if(r=t.topic,!n.pairings.keys.includes(r)){e.next=15;break}return e.next=7,n.sendRequest(r,"wc_pairingPing",{});case 7:return i=e.sent,a=Me(),o=a.done,c=a.resolve,u=a.reject,n.events.once(Ke("pairing_ping",i),(function(e){var t=e.error;t?u(t):c()})),e.next=15,o();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateExpiry=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.topic,i=t.expiry,n.isInitialized(),e.next=4,n.pairings.update(r,{expiry:i});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateMetadata=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.topic,i=t.metadata,n.isInitialized(),e.next=4,n.pairings.update(r,{peerMetadata:i});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getPairings=function(){return n.isInitialized(),n.pairings.values},this.disconnect=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidDisconnect(t);case 3:if(r=t.topic,e.t0=n.pairings.keys.includes(r),!e.t0){e.next=10;break}return e.next=8,n.sendRequest(r,"wc_pairingDelete",st("USER_DISCONNECTED"));case 8:return e.next=10,n.deletePairing(r);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.sendRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r,i){var a,o,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,Ct.formatJsonRpcRequest)(r,i),e.next=3,n.core.crypto.encode(t,a);case 3:return o=e.sent,c=Ln[r].req,n.core.history.set(t,a),e.next=8,n.core.relayer.publish(t,o,c);case 8:return e.abrupt("return",a.id);case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.sendResult=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r,i){var a,o,c,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,Ct.formatJsonRpcResult)(t,i),e.next=3,n.core.crypto.encode(r,a);case 3:return o=e.sent,e.next=6,n.core.history.get(r,t);case 6:return c=e.sent,u=Ln[c.request.method].res,e.next=10,n.core.relayer.publish(r,o,u);case 10:return e.next=12,n.core.history.resolve(a);case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.sendError=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r,i){var a,o,c,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,Ct.formatJsonRpcError)(t,i),e.next=3,n.core.crypto.encode(r,a);case 3:return o=e.sent,e.next=6,n.core.history.get(r,t);case 6:return c=e.sent,u=Ln[c.request.method]?Ln[c.request.method].res:Ln.unregistered_method.res,e.next=10,n.core.relayer.publish(r,o,u);case 10:return e.next=12,n.core.history.resolve(a);case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.deletePairing=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.core.relayer.unsubscribe(t);case 2:return e.next=4,Promise.all([n.pairings.delete(t,st("USER_DISCONNECTED")),n.core.crypto.deleteSymKey(t),r?Promise.resolve():n.core.expirer.del(t)]);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.cleanup=(0,a.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.pairings.getAll().filter((function(e){return ze(e.expiry)})),e.next=3,Promise.all(t.map((function(e){return n.deletePairing(e.topic)})));case 3:case"end":return e.stop()}}),e)}))),this.onRelayEventRequest=function(e){var t=e.topic,r=e.payload,i=r.method;if(n.pairings.keys.includes(t))switch(i){case"wc_pairingPing":return n.onPairingPingRequest(t,r);case"wc_pairingDelete":return n.onPairingDeleteRequest(t,r);default:return n.onUnknownRpcMethodRequest(t,r)}},this.onRelayEventResponse=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.topic,i=t.payload,e.next=4,n.core.history.get(r,i.id);case 4:if(a=e.sent.request.method,!n.pairings.keys.includes(r)){e.next=11;break}e.t0=a,e.next="wc_pairingPing"===e.t0?9:10;break;case 9:return e.abrupt("return",n.onPairingPingResponse(r,i));case 10:return e.abrupt("return",n.onUnknownRpcMethodResponse(a));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onPairingPingRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.id,e.prev=1,n.isValidPing({topic:t}),e.next=5,n.sendResult(i,t,!0);case 5:n.events.emit("pairing_ping",{id:i,topic:t}),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(1),e.next=12,n.sendError(i,t,e.t0);case 12:n.logger.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}(),this.onPairingPingResponse=function(e,t){var r=t.id;setTimeout((function(){(0,Ct.isJsonRpcResult)(t)?n.events.emit(Ke("pairing_ping",r),{}):(0,Ct.isJsonRpcError)(t)&&n.events.emit(Ke("pairing_ping",r),{error:t.error})}),500)},this.onPairingDeleteRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.id,e.prev=1,n.isValidDisconnect({topic:t}),e.next=5,n.sendResult(i,t,!0);case 5:return e.next=7,n.deletePairing(t);case 7:n.events.emit("pairing_delete",{id:i,topic:t}),e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,n.sendError(i,t,e.t0);case 14:n.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r){return e.apply(this,arguments)}}(),this.onUnknownRpcMethodRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i,a,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.id,a=r.method,e.prev=1,!n.registeredMethods.includes(a)){e.next=4;break}return e.abrupt("return");case 4:return o=st("WC_METHOD_UNSUPPORTED",a),e.next=7,n.sendError(i,t,o);case 7:n.logger.error(o),e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,n.sendError(i,t,e.t0);case 14:n.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r){return e.apply(this,arguments)}}(),this.onUnknownRpcMethodResponse=function(e){n.registeredMethods.includes(e)||n.logger.error(st("WC_METHOD_UNSUPPORTED",e))},this.isValidPair=function(e){if(!kt(e)){var t=it("MISSING_OR_INVALID","pair() params: ".concat(e)).message;throw new Error(t)}if(!function(e){if(ut(e,!1))try{return typeof new URL(e)<"u"}catch(t){return!1}return!1}(e.uri)){var r=it("MISSING_OR_INVALID","pair() uri: ".concat(e.uri)).message;throw new Error(r)}},this.isValidPing=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(t)){e.next=3;break}throw r=it("MISSING_OR_INVALID","ping() params: ".concat(t)),i=r.message,new Error(i);case 3:return a=t.topic,e.next=6,n.isValidPairingTopic(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.isValidDisconnect=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(t)){e.next=3;break}throw r=it("MISSING_OR_INVALID","disconnect() params: ".concat(t)),i=r.message,new Error(i);case 3:return a=t.topic,e.next=6,n.isValidPairingTopic(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.isValidPairingTopic=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ut(t,!1)){e.next=3;break}throw r=it("MISSING_OR_INVALID","pairing topic should be a string: ".concat(t)),i=r.message,new Error(i);case 3:if(n.pairings.keys.includes(t)){e.next=6;break}throw a=it("NO_MATCHING_KEY","pairing topic doesn't exist: ".concat(t)),o=a.message,new Error(o);case 6:if(!ze(n.pairings.get(t).expiry)){e.next=11;break}return e.next=9,n.deletePairing(t);case 9:throw c=it("EXPIRED","pairing topic: ".concat(t)),u=c.message,new Error(u);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.core=t,this.logger=(0,w.generateChildLogger)(r,this.name),this.pairings=new ki(this.core,this.logger,this.name,this.storagePrefix)}return(0,c.Z)(e,[{key:"context",get:function(){return(0,w.getLoggerContext)(this.logger)}},{key:"isInitialized",value:function(){if(!this.initialized){var e=it("NOT_INITIALIZED",this.name).message;throw new Error(e)}}},{key:"registerRelayerEvents",value:function(){var e=this;this.core.relayer.on(kn,function(){var t=(0,a.Z)((0,s.Z)().mark((function t(r){var n,i,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.topic,i=r.message,!e.ignoredPayloadTypes.includes(e.core.crypto.getPayloadType(i))){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e.core.crypto.decode(n,i);case 5:if(a=t.sent,!(0,Ct.isJsonRpcRequest)(a)){t.next=10;break}e.core.history.set(n,a),e.onRelayEventRequest({topic:n,payload:a}),t.next=15;break;case 10:if(t.t0=(0,Ct.isJsonRpcResponse)(a),!t.t0){t.next=15;break}return t.next=14,e.core.history.resolve(a);case 14:e.onRelayEventResponse({topic:n,payload:a});case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"registerExpirerEvents",value:function(){var e=this;this.core.expirer.on(Bn,function(){var t=(0,a.Z)((0,s.Z)().mark((function t(r){var n,i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=je(r.target),i=n.topic,t.t0=i&&e.pairings.keys.includes(i),!t.t0){t.next=6;break}return t.next=5,e.deletePairing(i,!0);case 5:e.events.emit("pairing_expire",{topic:i});case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}]),e}(),Ii=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,o.Z)(this,r),(i=t.call(this,e,n)).core=e,i.logger=n,i.records=new Map,i.events=new y.EventEmitter,i.name="history",i.version="0.3",i.cached=[],i.initialized=!1,i.storagePrefix=yn,i.init=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.initialized,e.t0){e.next=9;break}return i.logger.trace("Initialized"),e.next=5,i.restore();case 5:i.cached.forEach((function(e){return i.records.set(e.id,e)})),i.cached=[],i.registerEventListeners(),i.initialized=!0;case 9:case"end":return e.stop()}}),e)}))),i.set=function(e,t,r){if(i.isInitialized(),i.logger.debug("Setting JSON-RPC request history record"),i.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:r}),!i.records.has(t.id)){var n={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:r};i.records.set(n.id,n),i.events.emit(Vn,n)}},i.resolve=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isInitialized(),i.logger.debug("Updating JSON-RPC response history record"),i.logger.trace({type:"method",method:"update",response:t}),i.records.has(t.id)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,i.getRecord(t.id);case 4:typeof(r=e.sent).response>"u"&&(r.response=(0,Ct.isJsonRpcError)(t)?{error:t.error}:{result:t.result},i.records.set(r.id,r),i.events.emit(jn,r));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.get=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.isInitialized(),i.logger.debug("Getting record"),i.logger.trace({type:"method",method:"get",topic:t,id:r}),e.next=5,i.getRecord(r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),i.delete=function(e,t){i.isInitialized(),i.logger.debug("Deleting record"),i.logger.trace({type:"method",method:"delete",id:t}),i.values.forEach((function(r){if(r.topic===e){if(typeof t<"u"&&r.id!==t)return;i.records.delete(r.id),i.events.emit(Kn,r)}}))},i.exists=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isInitialized(),!i.records.has(r)){e.next=9;break}return e.next=4,i.getRecord(r);case 4:e.t1=e.sent.topic,e.t2=t,e.t0=e.t1===e.t2,e.next=10;break;case 9:e.t0=!1;case 10:return e.abrupt("return",e.t0);case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),i.on=function(e,t){i.events.on(e,t)},i.once=function(e,t){i.events.once(e,t)},i.off=function(e,t){i.events.off(e,t)},i.removeListener=function(e,t){i.events.removeListener(e,t)},i.logger=(0,w.generateChildLogger)(n,i.name),i}return(0,c.Z)(r,[{key:"context",get:function(){return(0,w.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"size",get:function(){return this.records.size}},{key:"keys",get:function(){return Array.from(this.records.keys())}},{key:"values",get:function(){return Array.from(this.records.values())}},{key:"pending",get:function(){var e=[];return this.values.forEach((function(t){if(!(typeof t.response<"u")){var r={topic:t.topic,request:(0,Ct.formatJsonRpcRequest)(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}})),e}},{key:"setJsonRpcRecords",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getJsonRpcRecords",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRecord",value:function(e){this.isInitialized();var t=this.records.get(e);if(!t){var r=it("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw new Error(r)}return t}},{key:"persist",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setJsonRpcRecords(this.values);case 2:this.events.emit(Hn);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"restore",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,r,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getJsonRpcRecords();case 3:if(!(typeof(t=e.sent)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.records.size){e.next=9;break}throw r=it("RESTORE_WILL_OVERRIDE",this.name),n=r.message,this.logger.error(n),new Error(n);case 9:this.cached=t,this.logger.debug("Successfully Restored records for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",records:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore records for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"registerEventListeners",value:function(){var e=this;this.events.on(Vn,(function(t){var r=Vn;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,record:t}),e.persist()})),this.events.on(jn,(function(t){var r=jn;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,record:t}),e.persist()})),this.events.on(Kn,(function(t){var r=Kn;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,record:t}),e.persist()}))}},{key:"isInitialized",value:function(){if(!this.initialized){var e=it("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),r}(E),_i=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,o.Z)(this,r),(i=t.call(this,e,n)).core=e,i.logger=n,i.expirations=new Map,i.events=new y.EventEmitter,i.name="expirer",i.version="0.3",i.cached=[],i.initialized=!1,i.storagePrefix=yn,i.init=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.initialized,e.t0){e.next=9;break}return i.logger.trace("Initialized"),e.next=5,i.restore();case 5:i.cached.forEach((function(e){return i.expirations.set(e.target,e)})),i.cached=[],i.registerEventListeners(),i.initialized=!0;case 9:case"end":return e.stop()}}),e)}))),i.has=function(e){try{var t=i.formatTarget(e);return typeof i.getExpiration(t)<"u"}catch(r){return!1}},i.set=function(e,t){i.isInitialized();var r=i.formatTarget(e),n={target:r,expiry:t};i.expirations.set(r,n),i.checkExpiry(r,n),i.events.emit(Gn,{target:r,expiration:n})},i.get=function(e){i.isInitialized();var t=i.formatTarget(e);return i.getExpiration(t)},i.del=function(e){if(i.isInitialized(),i.has(e)){var t=i.formatTarget(e),r=i.getExpiration(t);i.expirations.delete(t),i.events.emit(Jn,{target:t,expiration:r})}},i.on=function(e,t){i.events.on(e,t)},i.once=function(e,t){i.events.once(e,t)},i.off=function(e,t){i.events.off(e,t)},i.removeListener=function(e,t){i.events.removeListener(e,t)},i.logger=(0,w.generateChildLogger)(n,i.name),i}return(0,c.Z)(r,[{key:"context",get:function(){return(0,w.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"length",get:function(){return this.expirations.size}},{key:"keys",get:function(){return Array.from(this.expirations.keys())}},{key:"values",get:function(){return Array.from(this.expirations.values())}},{key:"formatTarget",value:function(e){if("string"==typeof e)return function(e){return Ve("topic",e)}(e);if("number"==typeof e)return function(e){return Ve("id",e)}(e);var t=it("UNKNOWN_TYPE","Target type: ".concat(typeof e)).message;throw new Error(t)}},{key:"setExpirations",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getExpirations",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"persist",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setExpirations(this.values);case 2:this.events.emit(Yn);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"restore",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,r,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getExpirations();case 3:if(!(typeof(t=e.sent)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.expirations.size){e.next=9;break}throw r=it("RESTORE_WILL_OVERRIDE",this.name),n=r.message,this.logger.error(n),new Error(n);case 9:this.cached=t,this.logger.debug("Successfully Restored expirations for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",expirations:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore expirations for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"getExpiration",value:function(e){var t=this.expirations.get(e);if(!t){var r=it("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw this.logger.error(r),new Error(r)}return t}},{key:"checkExpiry",value:function(e,t){var r=t.expiry;(0,W.toMiliseconds)(r)-Date.now()<=0&&this.expire(e,t)}},{key:"expire",value:function(e,t){this.expirations.delete(e),this.events.emit(Bn,{target:e,expiration:t})}},{key:"checkExpirations",value:function(){var e=this;this.expirations.forEach((function(t,r){return e.checkExpiry(r,t)}))}},{key:"registerEventListeners",value:function(){var e=this;this.core.heartbeat.on(b.HEARTBEAT_EVENTS.pulse,(function(){return e.checkExpirations()})),this.events.on(Gn,(function(t){var r=Gn;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,data:t}),e.persist()})),this.events.on(Bn,(function(t){var r=Bn;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,data:t}),e.persist()})),this.events.on(Jn,(function(t){var r=Jn;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,data:t}),e.persist()}))}},{key:"isInitialized",value:function(){if(!this.initialized){var e=it("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),r}(N),Si=Object.defineProperty,Pi=Object.getOwnPropertySymbols,Ri=Object.prototype.hasOwnProperty,Ni=Object.prototype.propertyIsEnumerable,Oi=function(e,t,r){return t in e?Si(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},Ti=function(e,t){for(var r in t||(t={}))Ri.call(t,r)&&Oi(e,r,t[r]);if(Pi){var n,s=(0,i.Z)(Pi(t));try{for(s.s();!(n=s.n()).done;){r=n.value;Ni.call(t,r)&&Oi(e,r,t[r])}}catch(a){s.e(a)}finally{s.f()}}return e},Ai=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;(0,o.Z)(this,r),(n=t.call(this,e)).protocol="wc",n.version=2,n.name=gn,n.events=new y.EventEmitter,n.initialized=!1,n.on=function(e,t){return n.events.on(e,t)},n.once=function(e,t){return n.events.once(e,t)},n.off=function(e,t){return n.events.off(e,t)},n.removeListener=function(e,t){return n.events.removeListener(e,t)},n.projectId=null===e||void 0===e?void 0:e.projectId;var i=typeof(null===e||void 0===e?void 0:e.logger)<"u"&&"string"!=typeof(null===e||void 0===e?void 0:e.logger)?e.logger:p()((0,w.getDefaultLoggerOptions)({level:(null===e||void 0===e?void 0:e.logger)||mn}));return n.logger=(0,w.generateChildLogger)(i,n.name),n.heartbeat=new b.HeartBeat,n.crypto=new Wn((0,l.Z)(n),n.logger,null===e||void 0===e?void 0:e.keychain),n.history=new Ii((0,l.Z)(n),n.logger),n.expirer=new _i((0,l.Z)(n),n.logger),n.storage=null!=e&&e.storage?e.storage:new x.ZP(Ti(Ti({},xn),null===e||void 0===e?void 0:e.storageOptions)),n.relayer=new gi({core:(0,l.Z)(n),logger:n.logger,relayUrl:null===e||void 0===e?void 0:e.relayUrl,projectId:n.projectId}),n.pairing=new Ei((0,l.Z)(n),n.logger),n}return(0,c.Z)(r,[{key:"context",get:function(){return(0,w.getLoggerContext)(this.logger)}},{key:"start",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.initialized,e.t0){e.next=4;break}return e.next=4,this.initialize();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initialize",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.trace("Initialized"),e.prev=1,e.next=4,this.crypto.init();case 4:return e.next=6,this.history.init();case 6:return e.next=8,this.expirer.init();case 8:return e.next=10,this.relayer.init();case 10:return e.next=12,this.heartbeat.init();case 12:return e.next=14,this.pairing.init();case 14:this.initialized=!0,this.logger.info("Core Initialization Success"),e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(1),this.logger.warn("Core Initialization Failure at epoch ".concat(Date.now()),e.t0),this.logger.error(e.t0.message),e.t0;case 21:case"end":return e.stop()}}),e,this,[[1,18]])})));return function(){return e.apply(this,arguments)}}()}],[{key:"init",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new r(t),e.next=3,n.initialize();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),r}(k),Ci=Ai,Di="client",qi="".concat("wc","@").concat(2,":").concat(Di,":"),Ui=Di,zi="error",Mi=(W.THIRTY_DAYS,W.SEVEN_DAYS),Li={wc_sessionPropose:{req:{ttl:W.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1104},res:{ttl:W.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1106},res:{ttl:W.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:W.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:W.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1112},res:{ttl:W.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:W.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:W.THIRTY_SECONDS,prompt:!1,tag:1115}}},Vi={min:W.FIVE_MINUTES,max:W.SEVEN_DAYS},ji=Object.defineProperty,Ki=Object.defineProperties,Hi=Object.getOwnPropertyDescriptors,Gi=Object.getOwnPropertySymbols,Ji=Object.prototype.hasOwnProperty,Bi=Object.prototype.propertyIsEnumerable,Yi=function(e,t,r){return t in e?ji(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},Fi=function(e,t){for(var r in t||(t={}))Ji.call(t,r)&&Yi(e,r,t[r]);if(Gi){var n,s=(0,i.Z)(Gi(t));try{for(s.s();!(n=s.n()).done;){r=n.value;Bi.call(t,r)&&Yi(e,r,t[r])}}catch(a){s.e(a)}finally{s.f()}}return e},Wi=function(e,t){return Ki(e,Hi(t))},Xi=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).name="engine",n.events=new(m()),n.initialized=!1,n.ignoredPayloadTypes=[ae],n.init=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n.initialized,e.t0){e.next=8;break}return e.next=4,n.cleanup();case 4:n.registerRelayerEvents(),n.registerExpirerEvents(),n.client.core.pairing.register({methods:Object.keys(Li)}),n.initialized=!0;case 8:case"end":return e.stop()}}),e)}))),n.connect=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,o,c,u,p,l,f,h,d,v,g,y,m,x,b,w,Z,k;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidConnect(t);case 3:if(r=t.pairingTopic,i=t.requiredNamespaces,o=t.relays,p=!1,(c=r)&&(p=n.client.core.pairing.pairings.get(c).active),c&&p){e.next=12;break}return e.next=8,n.client.core.pairing.create();case 8:l=e.sent,f=l.topic,h=l.uri,c=f,u=h;case 12:return e.next=14,n.client.core.crypto.generateKeyPair();case 14:if(d=e.sent,v={requiredNamespaces:i,relays:null!==o&&void 0!==o?o:[{protocol:"irn"}],proposer:{publicKey:d,metadata:n.client.metadata}},g=Me(),y=g.reject,m=g.resolve,x=g.done,n.events.once(Ke("session_connect"),function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.error,i=t.session,!r){e.next=5;break}y(r),e.next=17;break;case 5:if(!i){e.next=17;break}return i.self.publicKey=d,a=Wi(Fi({},i),{requiredNamespaces:i.requiredNamespaces}),e.next=10,n.client.session.set(i.topic,a);case 10:return e.next=12,n.setExpiry(i.topic,i.expiry);case 12:if(e.t0=c,!e.t0){e.next=16;break}return e.next=16,n.client.core.pairing.updateMetadata({topic:c,metadata:i.peer.metadata});case 16:m(a);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c){e.next=23;break}throw b=it("NO_MATCHING_KEY","connect() pairing topic: ".concat(c)),w=b.message,new Error(w);case 23:return e.next=25,n.sendRequest(c,"wc_sessionPropose",v);case 25:return Z=e.sent,k=Ue(W.FIVE_MINUTES),e.next=29,n.setProposal(Z,Fi({id:Z,expiry:k},v));case 29:return e.abrupt("return",{uri:u,approval:x});case 30:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.pair=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.client.core.pairing.pair(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.approve=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u,p,l,f,h,d,v,g,y,m,x,b;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidApprove(t);case 3:return r=t.id,i=t.relayProtocol,a=t.namespaces,o=n.client.proposal.get(r),c=o.pairingTopic,u=o.proposer,ot(p=o.requiredNamespaces)||(p=tt(a,"approve()"),n.client.proposal.set(r,Wi(Fi({},o),{requiredNamespaces:p}))),e.next=8,n.client.core.crypto.generateKeyPair();case 8:return l=e.sent,f=u.publicKey,e.next=12,n.client.core.crypto.generateSharedKey(l,f);case 12:return h=e.sent,d={relay:{protocol:null!==i&&void 0!==i?i:"irn"},namespaces:a,requiredNamespaces:p,controller:{publicKey:l,metadata:n.client.metadata},expiry:Ue(Mi)},e.next=16,n.client.core.relayer.subscribe(h);case 16:return e.next=18,n.sendRequest(h,"wc_sessionSettle",d);case 18:return v=e.sent,g=Me(),y=g.done,m=g.resolve,x=g.reject,n.events.once(Ke("session_approve",v),(function(e){var t=e.error;t?x(t):m(n.client.session.get(h))})),b=Wi(Fi({},d),{topic:h,acknowledged:!1,self:d.controller,peer:{publicKey:u.publicKey,metadata:u.metadata},controller:l}),e.next=27,n.client.session.set(h,b);case 27:return e.next=29,n.setExpiry(h,Ue(Mi));case 29:if(e.t0=c,!e.t0){e.next=33;break}return e.next=33,n.client.core.pairing.updateMetadata({topic:c,metadata:b.peer.metadata});case 33:if(e.t1=c&&r,!e.t1){e.next=41;break}return e.next=37,n.sendResult(r,c,{relay:{protocol:null!==i&&void 0!==i?i:"irn"},responderPublicKey:l});case 37:return e.next=39,n.client.proposal.delete(r,st("USER_DISCONNECTED"));case 39:return e.next=41,n.client.core.pairing.activate({topic:c});case 41:return e.abrupt("return",{topic:h,acknowledged:y});case 42:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.reject=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidReject(t);case 3:if(r=t.id,i=t.reason,a=n.client.proposal.get(r),o=a.pairingTopic,e.t0=o,!e.t0){e.next=10;break}return e.next=8,n.sendError(r,o,i);case 8:return e.next=10,n.client.proposal.delete(r,st("USER_DISCONNECTED"));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.update=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidUpdate(t);case 3:return r=t.topic,i=t.namespaces,e.next=7,n.sendRequest(r,"wc_sessionUpdate",{namespaces:i});case 7:return a=e.sent,o=Me(),c=o.done,u=o.resolve,p=o.reject,n.events.once(Ke("session_update",a),(function(e){var t=e.error;t?p(t):u()})),e.next=15,n.client.session.update(r,{namespaces:i});case 15:return e.abrupt("return",{acknowledged:c});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.extend=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidExtend(t);case 3:return r=t.topic,e.next=6,n.sendRequest(r,"wc_sessionExtend",{});case 6:return i=e.sent,a=Me(),o=a.done,c=a.resolve,u=a.reject,n.events.once(Ke("session_extend",i),(function(e){var t=e.error;t?u(t):c()})),e.next=14,n.setExpiry(r,Ue(Mi));case 14:return e.abrupt("return",{acknowledged:o});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.request=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u,p,l,f;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidRequest(t);case 3:return r=t.chainId,i=t.request,a=t.topic,o=t.expiry,e.next=9,n.sendRequest(a,"wc_sessionRequest",{request:i,chainId:r},o);case 9:return c=e.sent,u=Me(o),p=u.done,l=u.resolve,f=u.reject,n.events.once(Ke("session_request",c),(function(e){var t=e.error,r=e.result;t?f(t):l(r)})),e.next=17,p();case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.respond=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidRespond(t);case 3:if(r=t.topic,i=t.response,a=i.id,!(0,Ct.isJsonRpcResult)(i)){e.next=9;break}return e.next=7,n.sendResult(a,r,i.result);case 7:e.next=13;break;case 9:if(e.t0=(0,Ct.isJsonRpcError)(i),!e.t0){e.next=13;break}return e.next=13,n.sendError(a,r,i.error);case 13:n.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.ping=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidPing(t);case 3:if(r=t.topic,!n.client.session.keys.includes(r)){e.next=17;break}return e.next=7,n.sendRequest(r,"wc_sessionPing",{});case 7:return i=e.sent,a=Me(),o=a.done,c=a.resolve,u=a.reject,n.events.once(Ke("session_ping",i),(function(e){var t=e.error;t?u(t):c()})),e.next=15,o();case 15:e.next=21;break;case 17:if(e.t0=n.client.core.pairing.pairings.keys.includes(r),!e.t0){e.next=21;break}return e.next=21,n.client.core.pairing.ping({topic:r});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.emit=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidEmit(t);case 3:return r=t.topic,i=t.event,a=t.chainId,e.next=6,n.sendRequest(r,"wc_sessionEvent",{event:i,chainId:a});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.disconnect=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidDisconnect(t);case 3:if(r=t.topic,!n.client.session.keys.includes(r)){e.next=11;break}return e.next=7,n.sendRequest(r,"wc_sessionDelete",st("USER_DISCONNECTED"));case 7:return e.next=9,n.deleteSession(r);case 9:e.next=13;break;case 11:return e.next=13,n.client.core.pairing.disconnect({topic:r});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.find=function(e){return n.isInitialized(),n.client.session.getAll().filter((function(t){return function(e,t){var r=t.requiredNamespaces,n=Object.keys(e.namespaces),i=Object.keys(r),s=!0;return!!Ce(i,n)&&(n.forEach((function(t){var n=e.namespaces[t],i=n.accounts,a=n.methods,o=n.events,c=et(i),u=r[t];(!Ce(u.chains,c)||!Ce(u.methods,a)||!Ce(u.events,o))&&(s=!1)})),s)}(t,e)}))},n.getPendingSessionRequests=function(){return n.isInitialized(),n.client.pendingRequest.getAll()},n.deleteSession=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.client.session.get(t),a=i.self,e.next=3,n.client.core.relayer.unsubscribe(t);case 3:return e.next=5,Promise.all([n.client.session.delete(t,st("USER_DISCONNECTED")),n.client.core.crypto.deleteKeyPair(a.publicKey),n.client.core.crypto.deleteSymKey(t),r?Promise.resolve():n.client.core.expirer.del(t)]);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),n.deleteProposal=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.client.proposal.delete(t,st("USER_DISCONNECTED")),r?Promise.resolve():n.client.core.expirer.del(t)]);case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),n.deletePendingSessionRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i,a=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>2&&void 0!==a[2]&&a[2],e.next=3,Promise.all([n.client.pendingRequest.delete(t,r),i?Promise.resolve():n.client.core.expirer.del(t)]);case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),n.setExpiry=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n.client.session.keys.includes(t),!e.t0){e.next=4;break}return e.next=4,n.client.session.update(t,{expiry:r});case 4:n.client.core.expirer.set(t,r);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),n.setProposal=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.proposal.set(t,r);case 2:n.client.core.expirer.set(t,r.expiry);case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),n.setPendingSessionRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Li.wc_sessionRequest.req.ttl,i=t.id,a=t.topic,o=t.params,e.next=3,n.client.pendingRequest.set(i,{id:i,topic:a,params:o});case 3:r&&n.client.core.expirer.set(i,Ue(r));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.sendRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r,i,a){var o,c,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(0,Ct.formatJsonRpcRequest)(r,i),e.next=3,n.client.core.crypto.encode(t,o);case 3:return c=e.sent,u=Li[r].req,e.abrupt("return",(a&&(u.ttl=a),n.client.core.history.set(t,o),n.client.core.relayer.publish(t,c,u),o.id));case 6:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}(),n.sendResult=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r,i){var a,o,c,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,Ct.formatJsonRpcResult)(t,i),e.next=3,n.client.core.crypto.encode(r,a);case 3:return o=e.sent,e.next=6,n.client.core.history.get(r,t);case 6:return c=e.sent,u=Li[c.request.method].res,n.client.core.relayer.publish(r,o,u),e.next=11,n.client.core.history.resolve(a);case 11:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),n.sendError=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r,i){var a,o,c,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,Ct.formatJsonRpcError)(t,i),e.next=3,n.client.core.crypto.encode(r,a);case 3:return o=e.sent,e.next=6,n.client.core.history.get(r,t);case 6:return c=e.sent,u=Li[c.request.method].res,n.client.core.relayer.publish(r,o,u),e.next=11,n.client.core.history.resolve(a);case 11:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),n.cleanup=(0,a.Z)((0,s.Z)().mark((function e(){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],r=[],n.client.session.getAll().forEach((function(e){ze(e.expiry)&&t.push(e.topic)})),n.client.proposal.getAll().forEach((function(e){ze(e.expiry)&&r.push(e.id)})),e.next=5,Promise.all([].concat((0,f.Z)(t.map((function(e){return n.deleteSession(e)}))),(0,f.Z)(r.map((function(e){return n.deleteProposal(e)})))));case 5:case"end":return e.stop()}}),e)}))),n.onRelayEventRequest=function(e){var t=e.topic,r=e.payload,i=r.method;switch(i){case"wc_sessionPropose":return n.onSessionProposeRequest(t,r);case"wc_sessionSettle":return n.onSessionSettleRequest(t,r);case"wc_sessionUpdate":return n.onSessionUpdateRequest(t,r);case"wc_sessionExtend":return n.onSessionExtendRequest(t,r);case"wc_sessionPing":return n.onSessionPingRequest(t,r);case"wc_sessionDelete":return n.onSessionDeleteRequest(t,r);case"wc_sessionRequest":return n.onSessionRequest(t,r);case"wc_sessionEvent":return n.onSessionEventRequest(t,r);default:return n.client.logger.info("Unsupported request method ".concat(i))}},n.onRelayEventResponse=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.topic,i=t.payload,e.next=4,n.client.core.history.get(r,i.id);case 4:a=e.sent.request.method,e.t0=a,e.next="wc_sessionPropose"===e.t0?8:"wc_sessionSettle"===e.t0?9:"wc_sessionUpdate"===e.t0?10:"wc_sessionExtend"===e.t0?11:"wc_sessionPing"===e.t0?12:"wc_sessionRequest"===e.t0?13:14;break;case 8:return e.abrupt("return",n.onSessionProposeResponse(r,i));case 9:return e.abrupt("return",n.onSessionSettleResponse(r,i));case 10:return e.abrupt("return",n.onSessionUpdateResponse(r,i));case 11:return e.abrupt("return",n.onSessionExtendResponse(r,i));case 12:return e.abrupt("return",n.onSessionPingResponse(r,i));case 13:return e.abrupt("return",n.onSessionRequestResponse(r,i));case 14:return e.abrupt("return",n.client.logger.info("Unsupported response method ".concat(a)));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.onSessionProposeRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i,a,o,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.params,a=r.id,e.prev=1,n.isValidConnect(Fi({},r.params)),o=Ue(W.FIVE_MINUTES),c=Fi({id:a,pairingTopic:t,expiry:o},i),e.next=6,n.setProposal(a,c);case 6:n.client.events.emit("session_proposal",{id:a,params:c}),e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(1),e.next=13,n.sendError(a,t,e.t0);case 13:n.client.logger.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r){return e.apply(this,arguments)}}(),n.onSessionProposeResponse=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i,a,o,c,u,p,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.id,!(0,Ct.isJsonRpcResult)(r)){e.next=22;break}return a=r.result,n.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:a}),o=n.client.proposal.get(i),n.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:o}),c=o.proposer.publicKey,n.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c}),u=a.responderPublicKey,n.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u}),e.next=12,n.client.core.crypto.generateSharedKey(c,u);case 12:return p=e.sent,n.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:p}),e.next=16,n.client.core.relayer.subscribe(p);case 16:return l=e.sent,n.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),e.next=20,n.client.core.pairing.activate({topic:t});case 20:e.next=27;break;case 22:if(e.t0=(0,Ct.isJsonRpcError)(r),!e.t0){e.next=27;break}return e.next=26,n.client.proposal.delete(i,st("USER_DISCONNECTED"));case 26:n.events.emit(Ke("session_connect"),{error:r.error});case 27:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),n.onSessionSettleRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i,a,o,c,u,p,l,f,h;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.id,a=r.params,e.prev=1,n.isValidSessionSettleRequest(a),o=r.params,c=o.relay,u=o.controller,p=o.expiry,l=o.namespaces,f=o.requiredNamespaces,h={topic:t,relay:c,expiry:p,namespaces:l,acknowledged:!0,requiredNamespaces:f,controller:u.publicKey,self:{publicKey:"",metadata:n.client.metadata},peer:{publicKey:u.publicKey,metadata:u.metadata}},e.next=6,n.sendResult(r.id,t,!0);case 6:n.events.emit(Ke("session_connect"),{session:h}),e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(1),e.next=13,n.sendError(i,t,e.t0);case 13:n.client.logger.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r){return e.apply(this,arguments)}}(),n.onSessionSettleResponse=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.id,!(0,Ct.isJsonRpcResult)(r)){e.next=7;break}return e.next=4,n.client.session.update(t,{acknowledged:!0});case 4:n.events.emit(Ke("session_approve",i),{}),e.next=12;break;case 7:if(e.t0=(0,Ct.isJsonRpcError)(r),!e.t0){e.next=12;break}return e.next=11,n.client.session.delete(t,st("USER_DISCONNECTED"));case 11:n.events.emit(Ke("session_approve",i),{error:r.error});case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),n.onSessionUpdateRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.params,a=r.id,e.prev=1,n.isValidUpdate(Fi({topic:t},i)),e.next=5,n.client.session.update(t,{namespaces:i.namespaces});case 5:return e.next=7,n.sendResult(a,t,!0);case 7:n.client.events.emit("session_update",{id:a,topic:t,params:i}),e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,n.sendError(a,t,e.t0);case 14:n.client.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r){return e.apply(this,arguments)}}(),n.onSessionUpdateResponse=function(e,t){var r=t.id;(0,Ct.isJsonRpcResult)(t)?n.events.emit(Ke("session_update",r),{}):(0,Ct.isJsonRpcError)(t)&&n.events.emit(Ke("session_update",r),{error:t.error})},n.onSessionExtendRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.id,e.prev=1,n.isValidExtend({topic:t}),e.next=5,n.setExpiry(t,Ue(Mi));case 5:return e.next=7,n.sendResult(i,t,!0);case 7:n.client.events.emit("session_extend",{id:i,topic:t}),e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,n.sendError(i,t,e.t0);case 14:n.client.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r){return e.apply(this,arguments)}}(),n.onSessionExtendResponse=function(e,t){var r=t.id;(0,Ct.isJsonRpcResult)(t)?n.events.emit(Ke("session_extend",r),{}):(0,Ct.isJsonRpcError)(t)&&n.events.emit(Ke("session_extend",r),{error:t.error})},n.onSessionPingRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.id,e.prev=1,n.isValidPing({topic:t}),e.next=5,n.sendResult(i,t,!0);case 5:n.client.events.emit("session_ping",{id:i,topic:t}),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(1),e.next=12,n.sendError(i,t,e.t0);case 12:n.client.logger.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}(),n.onSessionPingResponse=function(e,t){var r=t.id;setTimeout((function(){(0,Ct.isJsonRpcResult)(t)?n.events.emit(Ke("session_ping",r),{}):(0,Ct.isJsonRpcError)(t)&&n.events.emit(Ke("session_ping",r),{error:t.error})}),500)},n.onSessionDeleteRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.id,e.prev=1,n.isValidDisconnect({topic:t,reason:r.params}),n.client.core.relayer.once(Rn,(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.deleteSession(t);case 2:case"end":return e.stop()}}),e)})))),e.next=6,n.sendResult(i,t,!0);case 6:n.client.events.emit("session_delete",{id:i,topic:t}),e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(1),e.next=13,n.sendError(i,t,e.t0);case 13:n.client.logger.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r){return e.apply(this,arguments)}}(),n.onSessionRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.id,a=r.params,e.prev=1,n.isValidRequest(Fi({topic:t},a)),e.next=5,n.setPendingSessionRequest({id:i,topic:t,params:a});case 5:n.client.events.emit("session_request",{id:i,topic:t,params:a}),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(1),e.next=12,n.sendError(i,t,e.t0);case 12:n.client.logger.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}(),n.onSessionRequestResponse=function(e,t){var r=t.id;(0,Ct.isJsonRpcResult)(t)?n.events.emit(Ke("session_request",r),{result:t.result}):(0,Ct.isJsonRpcError)(t)&&n.events.emit(Ke("session_request",r),{error:t.error})},n.onSessionEventRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=r.id,a=r.params,e.prev=1,n.isValidEmit(Fi({topic:t},a)),n.client.events.emit("session_event",{id:i,topic:t,params:a}),e.next=10;break;case 5:return e.prev=5,e.t0=e.catch(1),e.next=9,n.sendError(i,t,e.t0);case 9:n.client.logger.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[1,5]])})));return function(t,r){return e.apply(this,arguments)}}(),n.isValidConnect=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u,p,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(t)){e.next=3;break}throw r=it("MISSING_OR_INVALID","connect() params: ".concat(JSON.stringify(t))),i=r.message,new Error(i);case 3:if(a=t.pairingTopic,o=t.requiredNamespaces,c=t.relays,e.t0=ct(a),e.t0){e.next=8;break}return e.next=8,n.isValidPairingTopic(a);case 8:if(ct(o)||0!==ot(o)){e.next=10;break}return e.abrupt("return");case 10:if(!(u=mt(o,"connect()"))){e.next=13;break}throw new Error(u.message);case 13:if(wt(c,!0)){e.next=16;break}throw p=it("MISSING_OR_INVALID","connect() relays: ".concat(c)),l=p.message,new Error(l);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.isValidApprove=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u,p,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(t)){e.next=2;break}throw new Error(it("MISSING_OR_INVALID","approve() params: ".concat(t)).message);case 2:return r=t.id,i=t.namespaces,a=t.relayProtocol,e.next=5,n.isValidProposalId(r);case 5:if(o=n.client.proposal.get(r),!(c=xt(i,"approve()"))){e.next=8;break}throw new Error(c.message);case 8:if(!(u=Ot(o.requiredNamespaces,i,"update()"))){e.next=11;break}throw new Error(u.message);case 11:if(ut(a,!0)){e.next=14;break}throw p=it("MISSING_OR_INVALID","approve() relayProtocol: ".concat(a)),l=p.message,new Error(l);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.isValidReject=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(t)){e.next=3;break}throw r=it("MISSING_OR_INVALID","reject() params: ".concat(t)),i=r.message,new Error(i);case 3:return a=t.id,o=t.reason,e.next=6,n.isValidProposalId(a);case 6:if(Et(o)){e.next=9;break}throw c=it("MISSING_OR_INVALID","reject() reason: ".concat(JSON.stringify(o))),u=c.message,new Error(u);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.isValidSessionSettleRequest=function(e){if(!kt(e)){var t=it("MISSING_OR_INVALID","onSessionSettleRequest() params: ".concat(e)).message;throw new Error(t)}var r=e.relay,n=e.controller,i=e.namespaces,s=e.expiry;if(!bt(r)){var a=it("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string").message;throw new Error(a)}var o=function(e,t){var r=null;return ut(null===e||void 0===e?void 0:e.publicKey,!1)||(r=it("MISSING_OR_INVALID","".concat(t," controller public key should be a string"))),r}(n,"onSessionSettleRequest()");if(o)throw new Error(o.message);var c=xt(i,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(ze(s)){var u=it("EXPIRED","onSessionSettleRequest()").message;throw new Error(u)}},n.isValidUpdate=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(t)){e.next=3;break}throw r=it("MISSING_OR_INVALID","update() params: ".concat(t)),i=r.message,new Error(i);case 3:return a=t.topic,o=t.namespaces,e.next=6,n.isValidSessionTopic(a);case 6:if(c=n.client.session.get(a),!(u=xt(o,"update()"))){e.next=9;break}throw new Error(u.message);case 9:if(!(p=Ot(c.requiredNamespaces,o,"update()"))){e.next=12;break}throw new Error(p.message);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.isValidExtend=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(t)){e.next=3;break}throw r=it("MISSING_OR_INVALID","extend() params: ".concat(t)),i=r.message,new Error(i);case 3:return a=t.topic,e.next=6,n.isValidSessionTopic(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.isValidRequest=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u,p,l,f,h,d,v,g,y,m,x;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(t)){e.next=3;break}throw r=it("MISSING_OR_INVALID","request() params: ".concat(t)),i=r.message,new Error(i);case 3:return a=t.topic,o=t.request,c=t.chainId,u=t.expiry,e.next=6,n.isValidSessionTopic(a);case 6:if(p=n.client.session.get(a),Pt(l=p.namespaces,c)){e.next=10;break}throw f=it("MISSING_OR_INVALID","request() chainId: ".concat(c)),h=f.message,new Error(h);case 10:if(It(o)){e.next=13;break}throw d=it("MISSING_OR_INVALID","request() ".concat(JSON.stringify(o))),v=d.message,new Error(v);case 13:if(Rt(l,c,o.method)){e.next=16;break}throw g=it("MISSING_OR_INVALID","request() method: ".concat(o.method)),y=g.message,new Error(y);case 16:if(!u||Tt(u,Vi)){e.next=19;break}throw m=it("MISSING_OR_INVALID","request() expiry: ".concat(u,". Expiry must be a number (in seconds) between ").concat(Vi.min," and ").concat(Vi.max)),x=m.message,new Error(x);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.isValidRespond=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(t)){e.next=3;break}throw r=it("MISSING_OR_INVALID","respond() params: ".concat(t)),i=r.message,new Error(i);case 3:return a=t.topic,o=t.response,e.next=6,n.isValidSessionTopic(a);case 6:if(_t(o)){e.next=9;break}throw c=it("MISSING_OR_INVALID","respond() response: ".concat(JSON.stringify(o))),u=c.message,new Error(u);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.isValidPing=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(t)){e.next=3;break}throw r=it("MISSING_OR_INVALID","ping() params: ".concat(t)),i=r.message,new Error(i);case 3:return a=t.topic,e.next=6,n.isValidSessionOrPairingTopic(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.isValidEmit=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a,o,c,u,p,l,f,h,d,v,g;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(t)){e.next=3;break}throw r=it("MISSING_OR_INVALID","emit() params: ".concat(t)),i=r.message,new Error(i);case 3:return a=t.topic,o=t.event,c=t.chainId,e.next=6,n.isValidSessionTopic(a);case 6:if(u=n.client.session.get(a),Pt(p=u.namespaces,c)){e.next=10;break}throw l=it("MISSING_OR_INVALID","emit() chainId: ".concat(c)),f=l.message,new Error(f);case 10:if(St(o)){e.next=13;break}throw h=it("MISSING_OR_INVALID","emit() event: ".concat(JSON.stringify(o))),d=h.message,new Error(d);case 13:if(Nt(p,c,o.name)){e.next=16;break}throw v=it("MISSING_OR_INVALID","emit() event: ".concat(JSON.stringify(o))),g=v.message,new Error(g);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.isValidDisconnect=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(t)){e.next=3;break}throw r=it("MISSING_OR_INVALID","disconnect() params: ".concat(t)),i=r.message,new Error(i);case 3:return a=t.topic,e.next=6,n.isValidSessionOrPairingTopic(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n}return(0,c.Z)(r,[{key:"isInitialized",value:function(){if(!this.initialized){var e=it("NOT_INITIALIZED",this.name).message;throw new Error(e)}}},{key:"registerRelayerEvents",value:function(){var e=this;this.client.core.relayer.on(kn,function(){var t=(0,a.Z)((0,s.Z)().mark((function t(r){var n,i,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.topic,i=r.message,!e.ignoredPayloadTypes.includes(e.client.core.crypto.getPayloadType(i))){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e.client.core.crypto.decode(n,i);case 5:if(a=t.sent,!(0,Ct.isJsonRpcRequest)(a)){t.next=10;break}e.client.core.history.set(n,a),e.onRelayEventRequest({topic:n,payload:a}),t.next=15;break;case 10:if(t.t0=(0,Ct.isJsonRpcResponse)(a),!t.t0){t.next=15;break}return t.next=14,e.client.core.history.resolve(a);case 14:e.onRelayEventResponse({topic:n,payload:a});case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"registerExpirerEvents",value:function(){var e=this;this.client.core.expirer.on(Bn,function(){var t=(0,a.Z)((0,s.Z)().mark((function t(r){var n,i,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=je(r.target),i=n.topic,!(a=n.id)||!e.client.pendingRequest.keys.includes(a)){t.next=5;break}return t.next=4,e.deletePendingSessionRequest(a,it("EXPIRED"),!0);case 4:return t.abrupt("return",t.sent);case 5:if(!i){t.next=13;break}if(t.t0=e.client.session.keys.includes(i),!t.t0){t.next=11;break}return t.next=10,e.deleteSession(i,!0);case 10:e.client.events.emit("session_expire",{topic:i});case 11:t.next=18;break;case 13:if(t.t1=a,!t.t1){t.next=18;break}return t.next=17,e.deleteProposal(a,!0);case 17:e.client.events.emit("proposal_expire",{id:a});case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"isValidPairingTopic",value:function(e){if(!ut(e,!1)){var t=it("MISSING_OR_INVALID","pairing topic should be a string: ".concat(e)).message;throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){var r=it("NO_MATCHING_KEY","pairing topic doesn't exist: ".concat(e)).message;throw new Error(r)}if(ze(this.client.core.pairing.pairings.get(e).expiry)){var n=it("EXPIRED","pairing topic: ".concat(e)).message;throw new Error(n)}}},{key:"isValidSessionTopic",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,o,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ut(t,!1)){e.next=3;break}throw r=it("MISSING_OR_INVALID","session topic should be a string: ".concat(t)),n=r.message,new Error(n);case 3:if(this.client.session.keys.includes(t)){e.next=6;break}throw i=it("NO_MATCHING_KEY","session topic doesn't exist: ".concat(t)),a=i.message,new Error(a);case 6:if(!ze(this.client.session.get(t).expiry)){e.next=11;break}return e.next=9,this.deleteSession(t);case 9:throw o=it("EXPIRED","session topic: ".concat(t)),c=o.message,new Error(c);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isValidSessionOrPairingTopic",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,n,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.client.session.keys.includes(t)){e.next=5;break}return e.next=3,this.isValidSessionTopic(t);case 3:e.next=16;break;case 5:if(!this.client.core.pairing.pairings.keys.includes(t)){e.next=9;break}this.isValidPairingTopic(t),e.next=16;break;case 9:if(!ut(t,!1)){e.next=14;break}throw r=it("NO_MATCHING_KEY","session or pairing topic doesn't exist: ".concat(t)),n=r.message,new Error(n);case 14:throw i=it("MISSING_OR_INVALID","session or pairing topic should be a string: ".concat(t)),a=i.message,new Error(a);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isValidProposalId",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,o,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Zt(t)){e.next=3;break}throw r=it("MISSING_OR_INVALID","proposal id should be a number: ".concat(t)),n=r.message,new Error(n);case 3:if(this.client.proposal.keys.includes(t)){e.next=6;break}throw i=it("NO_MATCHING_KEY","proposal id doesn't exist: ".concat(t)),a=i.message,new Error(a);case 6:if(!ze(this.client.proposal.get(t).expiry)){e.next=11;break}return e.next=9,this.deleteProposal(t);case 9:throw o=it("EXPIRED","proposal id: ".concat(t)),c=o.message,new Error(c);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(T),Qi=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,o.Z)(this,r),(i=t.call(this,e,n,"proposal",qi)).core=e,i.logger=n,i}return(0,c.Z)(r)}(ki),$i=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,o.Z)(this,r),(i=t.call(this,e,n,"session",qi)).core=e,i.logger=n,i}return(0,c.Z)(r)}(ki),es=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,o.Z)(this,r),(i=t.call(this,e,n,"request",qi)).core=e,i.logger=n,i}return(0,c.Z)(r)}(ki),ts=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;(0,o.Z)(this,r),(n=t.call(this,e)).protocol="wc",n.version=2,n.name=Ui,n.events=new y.EventEmitter,n.on=function(e,t){return n.events.on(e,t)},n.once=function(e,t){return n.events.once(e,t)},n.off=function(e,t){return n.events.off(e,t)},n.removeListener=function(e,t){return n.events.removeListener(e,t)},n.removeAllListeners=function(e){return n.events.removeAllListeners(e)},n.connect=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.engine.connect(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),n.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),n.pair=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.engine.pair(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),n.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),n.approve=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.engine.approve(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),n.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),n.reject=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.engine.reject(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),n.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),n.update=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.engine.update(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),n.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),n.extend=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.engine.extend(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),n.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),n.request=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.engine.request(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),n.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),n.respond=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.engine.respond(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),n.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),n.ping=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.engine.ping(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),n.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),n.emit=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.engine.emit(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),n.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),n.disconnect=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.engine.disconnect(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),n.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),n.find=function(e){try{return n.engine.find(e)}catch(t){throw n.logger.error(t.message),t}},n.getPendingSessionRequests=function(){try{return n.engine.getPendingSessionRequests()}catch(e){throw n.logger.error(e.message),e}},n.name=(null===e||void 0===e?void 0:e.name)||Ui,n.metadata=(null===e||void 0===e?void 0:e.metadata)||(0,Q.D)()||{name:"",description:"",url:"",icons:[""]};var i=typeof(null===e||void 0===e?void 0:e.logger)<"u"&&"string"!=typeof(null===e||void 0===e?void 0:e.logger)?e.logger:p()((0,w.getDefaultLoggerOptions)({level:(null===e||void 0===e?void 0:e.logger)||zi}));return n.core=(null===e||void 0===e?void 0:e.core)||new Ci(e),n.logger=(0,w.generateChildLogger)(i,n.name),n.session=new $i(n.core,n.logger),n.proposal=new Qi(n.core,n.logger),n.pendingRequest=new es(n.core,n.logger),n.engine=new Xi((0,l.Z)(n)),n}return(0,c.Z)(r,[{key:"context",get:function(){return(0,w.getLoggerContext)(this.logger)}},{key:"pairing",get:function(){return this.core.pairing.pairings}},{key:"initialize",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.trace("Initialized"),e.prev=1,e.next=4,this.core.start();case 4:return e.next=6,this.session.init();case 6:return e.next=8,this.proposal.init();case 8:return e.next=10,this.pendingRequest.init();case 10:return e.next=12,this.engine.init();case 12:this.logger.info("SignClient Initialization Success"),e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(1),this.logger.info("SignClient Initialization Failure"),this.logger.error(e.t0.message),e.t0;case 18:case"end":return e.stop()}}),e,this,[[1,15]])})));return function(){return e.apply(this,arguments)}}()}],[{key:"init",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new r(t),e.next=3,n.initialize();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),r}(O),rs=r(10159);function ns(e,t){var r;return t.rpcMap&&(r=t.rpcMap[function(e){return Number(e[0].split(":")[1])}([e])]),r}var is=function(){function e(t){(0,o.Z)(this,e),this.name="eip155",this.namespace=t.namespace,this.client=t.client,this.events=t.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}return(0,c.Z)(e,[{key:"request",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.request.method,e.next="eth_requestAccounts"===e.t0?3:"eth_accounts"===e.t0?4:"wallet_switchEthereumChain"===e.t0?5:"eth_chainId"===e.t0?7:8;break;case 3:case 4:return e.abrupt("return",this.getAccounts());case 5:return n=t.request.params?null==(r=t.request.params[0])?void 0:r.chainId:"0x0",e.abrupt("return",(this.setDefaultChain(parseInt(n,16).toString()),null));case 7:return e.abrupt("return",this.getDefaultChainId());case 8:if(!this.namespace.methods.includes(t.request.method)){e.next=14;break}return e.next=11,this.client.request(t);case 11:e.t1=e.sent,e.next=15;break;case 14:e.t1=this.getHttpProvider().request(t.request);case 15:return e.abrupt("return",e.t1);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateNamespace",value:function(e){this.namespace=Object.assign(this.namespace,e)}},{key:"setDefaultChain",value:function(e,t){if(this.chainId=parseInt(e),!this.httpProviders[e]){var r=t||ns("".concat(this.name,":").concat(e),this.namespace);if(!r)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,r)}this.events.emit("chainChanged",this.chainId)}},{key:"requestAccounts",value:function(){return this.getAccounts()}},{key:"createHttpProvider",value:function(e,t){var r=t||ns(e,this.namespace);return typeof r>"u"?void 0:new At.r(new rs.k(r))}},{key:"setHttpProvider",value:function(e,t){var r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}},{key:"createHttpProviders",value:function(){var e=this,t={};return this.namespace.chains.forEach((function(r){t[r]=e.createHttpProvider(r)})),t}},{key:"getAccounts",value:function(){var e=this,t=this.namespace.accounts;return t&&t.filter((function(t){return t.split(":")[1]===e.chainId.toString()})).map((function(e){return e.split(":")[2]}))||[]}},{key:"getDefaultChainId",value:function(){if(this.chainId)return this.chainId;var e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}},{key:"getHttpProvider",value:function(){var e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}}]),e}(),ss=function(){function e(t){(0,o.Z)(this,e),this.name="solana",this.namespace=t.namespace,this.events=t.events,this.client=t.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}return(0,c.Z)(e,[{key:"updateNamespace",value:function(e){this.namespace=Object.assign(this.namespace,e)}},{key:"requestAccounts",value:function(){return this.getAccounts()}},{key:"getAccounts",value:function(){var e=this,t=this.namespace.accounts;return t&&t.filter((function(t){return t.split(":")[1]===e.chainId.toString()})).map((function(e){return e.split(":")[2]}))||[]}},{key:"createHttpProviders",value:function(){var e=this,t={};return this.namespace.chains.forEach((function(r){t[r]=e.createHttpProvider(r)})),t}},{key:"getDefaultChainId",value:function(){if(this.chainId)return this.chainId;var e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}},{key:"request",value:function(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}},{key:"getHttpProvider",value:function(){var e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}},{key:"setDefaultChain",value:function(e,t){if(this.chainId=e,!this.httpProviders[e]){var r=t||ns("".concat(this.name,":").concat(e),this.namespace);if(!r)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,r)}this.events.emit("chainChanged",this.chainId)}},{key:"setHttpProvider",value:function(e,t){var r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}},{key:"createHttpProvider",value:function(e,t){var r=t||ns(e,this.namespace);return typeof r>"u"?void 0:new At.r(new rs.Z(r))}}]),e}(),as=function(){function e(t){(0,o.Z)(this,e),this.name="cosmos",this.namespace=t.namespace,this.events=t.events,this.client=t.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}return(0,c.Z)(e,[{key:"updateNamespace",value:function(e){this.namespace=Object.assign(this.namespace,e)}},{key:"requestAccounts",value:function(){return this.getAccounts()}},{key:"getAccounts",value:function(){var e=this,t=this.namespace.accounts;return t&&t.filter((function(t){return t.split(":")[1]===e.chainId.toString()})).map((function(e){return e.split(":")[2]}))||[]}},{key:"createHttpProviders",value:function(){var e=this,t={};return this.namespace.chains.forEach((function(r){t[r]=e.createHttpProvider(r)})),t}},{key:"getDefaultChainId",value:function(){if(this.chainId)return this.chainId;var e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}},{key:"request",value:function(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}},{key:"getHttpProvider",value:function(){var e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}},{key:"setDefaultChain",value:function(e,t){if(this.chainId=e,!this.httpProviders[e]){var r=t||ns("".concat(this.name,":").concat(e),this.namespace);if(!r)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,r)}this.events.emit("chainChanged",this.chainId)}},{key:"setHttpProvider",value:function(e,t){var r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}},{key:"createHttpProvider",value:function(e,t){var r=t||ns(e,this.namespace);return typeof r>"u"?void 0:new At.r(new rs.Z(r))}}]),e}(),os=function(){function e(t){(0,o.Z)(this,e),this.name="cip34",this.namespace=t.namespace,this.events=t.events,this.client=t.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}return(0,c.Z)(e,[{key:"updateNamespace",value:function(e){this.namespace=Object.assign(this.namespace,e)}},{key:"requestAccounts",value:function(){return this.getAccounts()}},{key:"getAccounts",value:function(){var e=this,t=this.namespace.accounts;return t&&t.filter((function(t){return t.split(":")[1]===e.chainId.toString()})).map((function(e){return e.split(":")[2]}))||[]}},{key:"createHttpProviders",value:function(){var e=this,t={};return this.namespace.chains.forEach((function(r){t[r]=e.createHttpProvider(r)})),t}},{key:"getDefaultChainId",value:function(){if(this.chainId)return this.chainId;var e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}},{key:"request",value:function(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}},{key:"getHttpProvider",value:function(){var e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}},{key:"setDefaultChain",value:function(e,t){if(this.chainId=e,!this.httpProviders[e]){var r=t||ns("".concat(this.name,":").concat(e),this.namespace);if(!r)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,r)}this.events.emit("chainChanged",this.chainId)}},{key:"setHttpProvider",value:function(e,t){var r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}},{key:"createHttpProvider",value:function(e,t){var r=t||ns(e,this.namespace);return typeof r>"u"?void 0:new At.r(new rs.Z(r))}}]),e}(),cs="error",us="".concat("wc","@",2,":").concat("universal_provider",":"),ps=Object.defineProperty,ls=Object.defineProperties,fs=Object.getOwnPropertyDescriptors,hs=Object.getOwnPropertySymbols,ds=Object.prototype.hasOwnProperty,vs=Object.prototype.propertyIsEnumerable,gs=function(e,t,r){return t in e?ps(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},ys=function(e,t){for(var r in t||(t={}))ds.call(t,r)&&gs(e,r,t[r]);if(hs){var n,s=(0,i.Z)(hs(t));try{for(s.s();!(n=s.n()).done;){r=n.value;vs.call(t,r)&&gs(e,r,t[r])}}catch(a){s.e(a)}finally{s.f()}}return e},ms=function(){function e(t){(0,o.Z)(this,e),this.events=new(m()),this.rpcProviders={},this.providerOpts=t,this.logger=typeof(null===t||void 0===t?void 0:t.logger)<"u"&&"string"!=typeof(null===t||void 0===t?void 0:t.logger)?t.logger:p()((0,w.getDefaultLoggerOptions)({level:(null===t||void 0===t?void 0:t.logger)||cs}))}return(0,c.Z)(e,[{key:"request",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,r){var i,a,o,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.validateChain(r),a=(0,n.Z)(i,2),o=a[0],c=a[1],this.session){e.next=3;break}throw new Error("Please call connect() before request()");case 3:return e.next=5,this.getProvider(o).request({request:ys({},t),chainId:"".concat(o,":").concat(c),topic:this.session.topic});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"sendAsync",value:function(e,t,r){this.request(e,r).then((function(e){return t(null,e)})).catch((function(e){return t(e,void 0)}))}},{key:"enable",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client){e.next=2;break}throw new Error("Sign Client not initialized");case 2:if(e.t0=this.session,e.t0){e.next=6;break}return e.next=6,this.connect({namespaces:this.namespaces});case 6:return e.next=8,this.requestAccounts();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.session){e.next=2;break}throw new Error("Please call connect() before enable()");case 2:return e.next=4,this.client.disconnect({topic:null==(t=this.session)?void 0:t.topic,reason:st("USER_DISCONNECTED")});case 4:return e.next=6,this.cleanup();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client){e.next=2;break}throw new Error("Sign Client not initialized");case 2:return r=t.namespaces,this.setNamespaces(r),this.createProviders(),e.next=7,this.cleanupPendingPairings();case 7:if(!0!==t.skipPairing){e.next=11;break}e.t0=void 0,e.next=14;break;case 11:return e.next=13,this.pair(t.pairingTopic);case 13:e.t0=e.sent;case 14:return e.abrupt("return",e.t0);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}},{key:"removeListener",value:function(e,t){this.events.removeListener(e,t)}},{key:"off",value:function(e,t){this.events.off(e,t)}},{key:"isWalletConnect",get:function(){return!0}},{key:"pair",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,n,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces});case 2:return r=e.sent,n=r.uri,i=r.approval,n&&(this.uri=n,this.events.emit("display_uri",n)),e.next=8,i();case 8:return this.session=e.sent,this.onSessionUpdate(),this.onConnect(),e.abrupt("return",this.session);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setDefaultChain",value:function(e,t){try{var r=this.validateChain(e),i=(0,n.Z)(r,2),s=i[0],a=i[1];this.getProvider(s).setDefaultChain(a,t)}catch(s){if(!/Please call connect/.test(s.message))throw s}}},{key:"cleanupPendingPairings",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,r,n,a,o,c=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]?c[0]:{},this.logger.info("Cleaning up inactive pairings..."),!at(r=this.client.pairing.getAll())){e.next=26;break}n=(0,i.Z)(r),e.prev=5,n.s();case 7:if((a=n.n()).done){e.next=17;break}if(o=a.value,!t.deletePairings){e.next=13;break}this.client.core.expirer.set(o.topic,0),e.next=15;break;case 13:return e.next=15,this.client.core.relayer.subscriber.unsubscribe(o.topic);case 15:e.next=7;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(5),n.e(e.t0);case 22:return e.prev=22,n.f(),e.finish(22);case 25:this.logger.info("Inactive pairings cleared: ".concat(r.length));case 26:case"end":return e.stop()}}),e,this,[[5,19,22,25]])})));return function(){return e.apply(this,arguments)}}()},{key:"checkStorage",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.core.storage.getItem("".concat(us,"/namespaces"));case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={};case 5:if(this.namespaces=e.t0,this.namespaces&&this.createProviders(),!this.client.session.length){e.next=10;break}t=this.client.session.keys.length-1,this.session=this.client.session.get(this.client.session.keys[t]),this.onSessionUpdate();case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initialize",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.trace("Initialized"),e.next=3,this.createClient();case 3:this.checkStorage(),this.registerEventListeners();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createClient",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.providerOpts.client,e.t0){e.next=5;break}return e.next=4,ts.init({logger:this.providerOpts.logger||cs,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.com",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name});case 4:e.t0=e.sent;case 5:this.client=e.t0,this.logger.trace("SignClient Initialized");case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createProviders",value:function(){var e=this;if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach((function(t){switch(t){case"eip155":e.rpcProviders[t]=new is({client:e.client,namespace:e.namespaces[t],events:e.events});break;case"solana":e.rpcProviders[t]=new ss({client:e.client,namespace:e.namespaces[t],events:e.events});break;case"cosmos":e.rpcProviders[t]=new as({client:e.client,namespace:e.namespaces[t],events:e.events});break;case"polkadot":break;case"cip34":e.rpcProviders[t]=new os({client:e.client,namespace:e.namespaces[t],events:e.events})}}))}},{key:"registerEventListeners",value:function(){var e=this;if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",(function(t){e.events.emit("session_ping",t)})),this.client.on("session_event",(function(t){var r=t.params,n=r.event;"accountsChanged"===n.name?e.events.emit("accountsChanged",n.data):"chainChanged"===n.name?e.onChainChanged(n.data,r.chainId):e.events.emit(n.name,n.data),e.events.emit("session_event",t)})),this.client.on("session_update",(function(t){var r,n=t.topic,i=t.params,s=i.namespaces,a=null==(r=e.client)?void 0:r.session.get(n);e.session=function(e,t){return ls(e,fs(t))}(ys({},a),{namespaces:s}),e.onSessionUpdate(),e.events.emit("session_update",{topic:n,params:i})})),this.client.on("session_delete",function(){var t=(0,a.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.cleanup();case 2:e.events.emit("session_delete",r);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"getProvider",value:function(e){if(!this.rpcProviders[e])throw new Error("Provider not found: ".concat(e));return this.rpcProviders[e]}},{key:"onSessionUpdate",value:function(){var e=this;Object.keys(this.rpcProviders).forEach((function(t){var r;e.getProvider(t).updateNamespace(null==(r=e.session)?void 0:r.namespaces[t])}))}},{key:"setNamespaces",value:function(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem("".concat(us,"/namespaces"),e),this.namespaces=e}},{key:"validateChain",value:function(e){var t=(null===e||void 0===e?void 0:e.split(":"))||["",""],r=(0,n.Z)(t,2),i=r[0],s=r[1];if(i&&!Object.keys(this.namespaces).includes(i))throw new Error("Namespace '".concat(i,"' is not configured. Please call connect() first with namespace config."));return i&&s?[i,s]:function(e){var t,r=null==(t=e[Object.keys(e)[0]])?void 0:t.chains[0];return[r.split(":")[0],r.split(":")[1]]}(this.namespaces)}},{key:"requestAccounts",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.validateChain(),r=(0,n.Z)(t,1),i=r[0],e.next=3,this.getProvider(i).requestAccounts();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onChainChanged",value:function(e,t){var r=this.validateChain(t),i=(0,n.Z)(r,2),s=i[0],a=i[1];this.getProvider(s).setDefaultChain(a),this.events.emit("chainChanged",e)}},{key:"onConnect",value:function(){this.events.emit("connect",{session:this.session})}},{key:"cleanup",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.session=void 0,e.next=3,this.cleanupPendingPairings({deletePairings:!0});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"init",value:function(){var t=(0,a.Z)((0,s.Z)().mark((function t(r){var n;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new e(r),t.next=3,n.initialize();case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}(),xs=ms}}]);
//# sourceMappingURL=592.18876dae.chunk.js.map